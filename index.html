function updateOverallScoring() {
            const tbody = document.getElementById('overall-scores-body');
            tbody.innerHTML = '';
            
            let team1GrandTotal = 0;
            let team2GrandTotal = 0;
            
            // Display detailed tournament matches
            updateTournamentMatches();
            
            rounds.forEach(round => {
                if (round.completed) {
                    const row = document.createElement('tr');
                    const maxPoints = round.matchType === '1v1' ? 8 : 18; // Adjust based on match type
                    
                    row.innerHTML = `
                        <td>${round.name}</td>
                        <td>${round.team1Points}</td>
                        <td>${round.team2Points}</td>
                        <td>${maxPoints}</td>
                    `;
                    tbody.appendChild(row);
                    
                    team1GrandTotal += round.team1Points;
                    team2GrandTotal += round.team2Points;
                }
            });
            
            // Add totals row
            const totalRow = document.createElement('tr');
            totalRow.style.fontWeight = 'bold';
            totalRow.style.backgroundColor = '#f8f9fa';
            totalRow.innerHTML = `
                <td>TOTAL</td>
                <td>${team1GrandTotal}</td>
                <td>${team2GrandTotal}</td>
                <td>440</td>
            `;
            tbody.appendChild(totalRow);
            
            // Update team totals display
            document.getElementById('team-totals').innerHTML = `
                <h4>Team 1: ${team1GrandTotal} points</h4>
                <h4>Team 2: ${team2GrandTotal} points</h4>
                ${team1GrandTotal >= 221 ? '<p style="color: var(--garnet); font-weight: bold;">üèÜ TEAM 1 WINS!</p>' : ''}
                ${team2GrandTotal >= 221 ? '<p style="color: var(--garnet); font-weight: bold;">üèÜ TEAM 2 WINS!</p>' : ''}
            `;
            
            // Update MVP leaderboard
            updateMVPLeaderboard();
        }

        function updateTournamentMatches() {
            const container = document.getElementById('tournament-matches-container');
            container.innerHTML = '';
            
            rounds.forEach(round => {
                if (round.completed) {
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'match-detail';
                    
                    let matchDetails = `<h4>${round.name} - ${round.matchType}</h4>`;
                    matchDetails += `<p><strong>Final Score:</strong> Team 1: ${round.team1Points} - Team 2: ${round.team2Points}</p>`;
                    
                    if (round.playerScores) {
                        matchDetails += '<h5>Player Scores:</h5>';
                        Object.keys(round.playerScores).forEach(playerName => {
                            const scores = round.playerScores[playerName];
                            const totalScore = scores.reduce((sum, hole) => sum + hole.score, 0);
                            const photo = getPlayerPhoto(playerName);
                            const photoHtml = photo ? `<img src="${photo}" class="player-photo-display" alt="${playerName}">` : '';
                            
                            matchDetails += `
                                <div style="display: flex; align-items: center; margin: 0.5rem 0;">
                                    ${photoHtml}
                                    <span><strong>${playerName}:</strong> ${totalScore} (${scores.length} holes)</span>
                                </div>
                            `;
                        });
                    }
                    
                    matchDiv.innerHTML = matchDetails;
                    container.appendChild(matchDiv);
                }
            });
            
            if (container.innerHTML === '') {
                container.innerHTML = '<p>No completed matches yet.</p>';
            }
        }

        function updateMVPLeaderboard() {
            const leaderboardContent = document.getElementById('leaderboard-content');
            
            // Calculate player performance scores
            const playerStats = {};
            
            teams.forEach(team => {
                team.players.forEach(player => {
                    playerStats[player.name] = {
                        name: player.name,
                        teamName: team.name,
                        totalRounds: 0,
                        averageScore: 0,
                        totalScore: 0,
                        birdiesAndBetter: 0,
                        pars: 0,
                        bogeyOrWorse: 0,
                        wins: 0,
                        losses: 0,
                        ties: 0
                    };
                });
            });
            
            // Process round data for MVP calculation
            const course = courses[courses.length - 1];
            if (!course) {
                leaderboardContent.innerHTML = '<p>Please set up a course first to see MVP candidates.</p>';
                return;
            }
            
            rounds.forEach(round => {
                if (round.completed && round.playerScores) {
                    // Calculate match results for win/loss tracking
                    if (round.matchType === '2v2-best' || round.matchType === '2v2-combined') {
                        const team1Players = [];
                        const team2Players = [];
                        
                        // Categorize players by team
                        Object.keys(round.playerScores).forEach(playerName => {
                            const playerTeam = teams.find(team => team.players.some(p => p.name === playerName));
                            if (playerTeam) {
                                if (playerTeam === teams[0]) {
                                    team1Players.push(playerName);
                                } else {
                                    team2Players.push(playerName);
                                }
                            }
                        });
                        
                        // Update win/loss records
                        if (round.team1Points > round.team2Points) {
                            team1Players.forEach(playerName => {
                                if (playerStats[playerName]) playerStats[playerName].wins++;
                            });
                            team2Players.forEach(playerName => {
                                if (playerStats[playerName]) playerStats[playerName].losses++;
                            });
                        } else if (round.team2Points > round.team1Points) {
                            team2Players.forEach(playerName => {
                                if (playerStats[playerName]) playerStats[playerName].wins++;
                            });
                            team1Players.forEach(playerName => {
                                if (playerStats[playerName]) playerStats[playerName].losses++;
                            });
                        } else {
                            [...team1Players, ...team2Players].forEach(playerName => {
                                if (playerStats[playerName]) playerStats[playerName].ties++;
                            });
                        }
                    }
                    
                    // Process scoring statistics
                    Object.keys(round.playerScores).forEach(playerName => {
                        if (playerStats[playerName]) {
                            const scores = round.playerScores[playerName];
                            playerStats[playerName].totalRounds++;
                            
                            scores.forEach(holeScore => {
                                playerStats[playerName].totalScore += holeScore.score;
                                const hole = course.holes.find(h => h.number === holeScore.hole);
                                if (hole) {
                                    const scoreToPar = holeScore.score - hole.par;
                                    
                                    if (scoreToPar <= -1) {
                                        playerStats[playerName].birdiesAndBetter++;
                                    } else if (scoreToPar === 0) {
                                        playerStats[playerName].pars++;
                                    } else {
                                        playerStats[playerName].bogeyOrWorse++;
                                    }
                                }
                            });
                            
                            playerStats[playerName].averageScore = playerStats[playerName].totalScore / (playerStats[playerName].totalRounds * 18);
                        }
                    });
                }
            });
            
            // Calculate MVP score (lower average + more birdies/pars = better)
            const mvpCandidates = Object.values(playerStats)
                .filter(player => player.totalRounds > 0)
                .map(player => {
                    const mvpScore = (player.birdiesAndBetter * 3 + player.pars * 1) - player.averageScore;
                    const winPercentage = player.wins + player.losses + player.ties > 0 ? 
                        (player.wins + player.ties * 0.5) / (player.wins + player.losses + player.ties) : 0;
                    return { ...player, mvpScore: mvpScore + (winPercentage * 2) }; // Add win percentage bonus
                })
                .sort((a, b) => b.mvpScore - a.mvpScore)
                .slice(0, 3);
            
            if (mvpCandidates.length === 0) {
                leaderboardContent.innerHTML = '<p>No data available yet. Complete some rounds to see MVP candidates.</p>';
                return;
            }
            
            let leaderboardHtml = '';
            mvpCandidates.forEach((candidate, index) => {
                const photo = getPlayerPhoto(candidate.name);
                const photoHtml = photo ? `<img src="${photo}" class="leaderboard-photo" alt="${candidate.name}">` : 
                    '<div class="leaderboard-photo" style="background: var(--garnet); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">' + candidate.name.charAt(0) + '</div>';
                
                const position = index + 1;
                const medal = position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : 'ü•â';
                
                leaderboardHtml += `
                    <div class="leaderboard-item">
                        <div class="leaderboard-position">${medal} ${position}</div>
                        ${photoHtml}
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${candidate.name}</div>
                            <div class="leaderboard-score">
                                ${candidate.teamName} | Avg: ${candidate.averageScore.toFixed(1)} | 
                                Record: ${candidate.wins}-${candidate.losses}-${candidate.ties} | 
                                Birdies+: ${candidate.birdiesAndBetter} | Pars: ${candidate.pars}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            leaderboardContent.innerHTML = leaderboardHtml;
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brother Frank Cup</title>
    <style>
        :root {
            --garnet: #782F40;
            --gold: #FFD700;
            --light-garnet: #8B4054;
            --dark-garnet: #5A2230;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, var(--garnet), var(--dark-garnet));
            color: var(--gold);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: var(--garnet);
            border-bottom: 3px solid var(--gold);
            overflow-x: auto;
            white-space: nowrap;
        }

        .tab {
            background: var(--garnet);
            color: var(--gold);
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-right: 1px solid var(--dark-garnet);
            font-weight: bold;
            min-width: 120px;
        }

        .tab:hover {
            background: var(--light-garnet);
        }

        .tab.active {
            background: var(--gold);
            color: var(--garnet);
            border-bottom: 3px solid var(--garnet);
        }

        .content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
            background: white;
            border: 2px solid var(--garnet);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--garnet);
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--garnet);
            border-radius: 4px;
            font-size: 1rem;
        }

        .btn {
            background: var(--garnet);
            color: var(--gold);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: var(--dark-garnet);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            border: 2px solid var(--garnet);
        }

        .table th, 
        .table td {
            border: 1px solid var(--garnet);
            padding: 0.5rem;
            text-align: center;
        }

        .table th {
            background: var(--garnet);
            color: var(--gold);
            font-weight: bold;
        }

        .table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .course-setup, .team-setup {
            display: grid;
            gap: 1rem;
        }

        .hole-input {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.5rem;
            align-items: center;
            padding: 0.5rem;
            border: 1px solid var(--garnet);
            border-radius: 4px;
            margin: 0.5rem 0;
        }

        .player-card {
            border: 2px solid var(--garnet);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            background: white;
        }

        .scorecard-input {
            width: 60px;
            padding: 0.25rem;
            margin: 0.25rem;
            text-align: center;
            border: 1px solid var(--garnet);
            border-radius: 4px;
        }

        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 8px;
            border: 3px solid var(--garnet);
            max-width: 400px;
            width: 90%;
        }

        .match-card {
            border: 2px solid var(--garnet);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            background: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: var(--gold);
            border: 2px solid var(--garnet);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--garnet);
        }

        .stat-label {
            color: var(--garnet);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .tab {
                padding: 0.75rem 1rem;
                min-width: 100px;
                font-size: 0.9rem;
            }

            .content {
                padding: 1rem;
            }

            .hole-input {
                grid-template-columns: 1fr;
            }

            .scorecard-input {
                width: 50px;
            }
        }

        .photo-preview {
            margin-top: 0.5rem;
            max-width: 100px;
            max-height: 100px;
            border: 2px solid var(--garnet);
            border-radius: 8px;
            overflow: hidden;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .player-photo-display {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--garnet);
            margin-right: 10px;
        }

        .match-detail {
            background: #f8f9fa;
            border: 1px solid var(--garnet);
            border-radius: 4px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .leaderboard {
            background: linear-gradient(135deg, var(--gold), #FFA500);
            border: 3px solid var(--garnet);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .leaderboard h4 {
            color: var(--garnet);
            text-align: center;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: white;
            border: 2px solid var(--garnet);
            border-radius: 6px;
        }

        .leaderboard-position {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--garnet);
            margin-right: 1rem;
            min-width: 40px;
        }

        .leaderboard-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--garnet);
            margin-right: 1rem;
        }

        .leaderboard-info {
            flex-grow: 1;
        }

        .leaderboard-name {
            font-weight: bold;
            color: var(--garnet);
            font-size: 1.1rem;
        }

        .leaderboard-score {
            color: #666;
            font-size: 0.9rem;
        }

        .team-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .round-complete {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Brother Frank Cup</h1>
        <p>Golf Tournament Management System</p>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('course-setup')">Course Setup</button>
        <button class="tab" onclick="showTab('team-setup')">Team Setup</button>
        <button class="tab" onclick="showTab('scorecard')">Scorecard</button>
        <button class="tab" onclick="showTab('live-scoring')">Live Scoring</button>
        <button class="tab" onclick="showTab('overall-scoring')">Overall Scoring</button>
        <button class="tab" onclick="showTab('player-stats')">Player Statistics</button>
        <button class="tab" onclick="showTab('tournament-history')">Tournament History</button>
    </div>

    <div class="content">
        <!-- Course Setup Tab -->
        <div id="course-setup" class="tab-content active">
            <h2>Golf Course Setup (No Fun Banning Access Only)</h2>
            <div class="form-group">
                <label for="course-name">Course Name:</label>
                <input type="text" id="course-name" placeholder="Enter course name">
            </div>
            <div class="form-group">
                <label for="tournament-year">Tournament Year:</label>
                <input type="number" id="tournament-year" placeholder="2024" min="2020" max="2050">
            </div>
            <h3>Hole Setup</h3>
            <div id="holes-container">
                <!-- Holes will be dynamically generated -->
            </div>
            <button class="btn" onclick="generateHoles()">Generate 18 Holes</button>
            <button class="btn" onclick="saveCourse()">Save Course</button>
            <button class="btn btn-danger" onclick="deleteCourse()">Delete Course</button>
            <div id="saved-courses"></div>
        </div>

        <!-- Match Setup Tab -->
        <div id="match-setup" class="tab-content">
            <h2>Match Setup (No Fun Banning Access Only)</h2>
            
            <div class="form-group">
                <label for="setup-round-name">Round Name:</label>
                <select id="setup-round-name" onchange="loadRoundTemplate()">
                    <option value="">Select Round</option>
                    <option value="Thursday AM">Thursday AM</option>
                    <option value="Thursday PM">Thursday PM</option>
                    <option value="Friday AM">Friday AM</option>
                    <option value="Friday PM">Friday PM</option>
                    <option value="Saturday AM">Saturday AM (1v1 Individual)</option>
                    <option value="Saturday PM">Saturday PM</option>
                    <option value="Alternate Shot">Alternate Shot</option>
                </select>
            </div>

            <div class="form-group">
                <label for="setup-match-type">Match Type:</label>
                <select id="setup-match-type" onchange="updateMatchSetup()">
                    <option value="">Select Match Type</option>
                    <option value="2v2-best">2 vs 2 - Best Net Score</option>
                    <option value="2v2-combined">2 vs 2 - Combined Net Score</option>
                    <option value="1v1">1 vs 1 Individual</option>
                    <option value="alternate-shot">Alternate Shot</option>
                </select>
            </div>

            <div id="match-setup-container">
                <p>Select a round and match type to set up matches.</p>
            </div>

            <button class="btn" onclick="saveMatchSetup()">Save Match Setup</button>
            <button class="btn btn-danger" onclick="clearMatchSetup()">Clear Setup</button>

            <div id="saved-match-setups">
                <h3>Saved Match Setups</h3>
                <div id="match-setups-list"></div>
            </div>
        </div>

        <!-- Team Setup Tab -->
        <div id="team-setup" class="tab-content">
            <h2>Team Setup (No Fun Banning Access Only)</h2>
            <div class="form-group">
                <label for="team-name">Team Name:</label>
                <input type="text" id="team-name" placeholder="Enter team name">
            </div>
            <h3>Team Players</h3>
            <div id="team-players-container">
                <div class="player-card">
                    <div class="form-group">
                        <label>Player 1 Name:</label>
                        <input type="text" class="player-name" placeholder="Player name">
                    </div>
                    <div class="form-group">
                        <label>Player 1 Handicap:</label>
                        <input type="number" class="player-handicap" placeholder="Handicap" min="0" max="36">
                    </div>
                    <div class="form-group">
                        <label>Player 1 Photo (Optional):</label>
                        <input type="file" class="player-photo" accept="image/*" onchange="handlePhotoUpload(this, 0)">
                        <div class="photo-preview" id="photo-preview-0"></div>
                    </div>
                </div>
                <div class="player-card">
                    <div class="form-group">
                        <label>Player 2 Name:</label>
                        <input type="text" class="player-name" placeholder="Player name">
                    </div>
                    <div class="form-group">
                        <label>Player 2 Handicap:</label>
                        <input type="number" class="player-handicap" placeholder="Handicap" min="0" max="36">
                    </div>
                    <div class="form-group">
                        <label>Player 2 Photo (Optional):</label>
                        <input type="file" class="player-photo" accept="image/*" onchange="handlePhotoUpload(this, 1)">
                        <div class="photo-preview" id="photo-preview-1"></div>
                    </div>
                </div>
                <div class="player-card">
                    <div class="form-group">
                        <label>Player 3 Name:</label>
                        <input type="text" class="player-name" placeholder="Player name">
                    </div>
                    <div class="form-group">
                        <label>Player 3 Handicap:</label>
                        <input type="number" class="player-handicap" placeholder="Handicap" min="0" max="36">
                    </div>
                    <div class="form-group">
                        <label>Player 3 Photo (Optional):</label>
                        <input type="file" class="player-photo" accept="image/*" onchange="handlePhotoUpload(this, 2)">
                        <div class="photo-preview" id="photo-preview-2"></div>
                    </div>
                </div>
                <div class="player-card">
                    <div class="form-group">
                        <label>Player 4 Name:</label>
                        <input type="text" class="player-name" placeholder="Player name">
                    </div>
                    <div class="form-group">
                        <label>Player 4 Handicap:</label>
                        <input type="number" class="player-handicap" placeholder="Handicap" min="0" max="36">
                    </div>
                    <div class="form-group">
                        <label>Player 4 Photo (Optional):</label>
                        <input type="file" class="player-photo" accept="image/*" onchange="handlePhotoUpload(this, 3)">
                        <div class="photo-preview" id="photo-preview-3"></div>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="saveTeam()">Save Team</button>
            <button class="btn btn-danger" onclick="deleteTeam()">Delete Team</button>
            <div id="saved-teams"></div>
        </div>

        <!-- Scorecard Tab -->
        <div id="scorecard" class="tab-content">
            <h2>Scorecard Entry</h2>
            <div class="form-group">
                <label for="round-name">Round Name:</label>
                <input type="text" id="round-name" placeholder="e.g., Thursday AM">
            </div>
            <div class="form-group">
                <label for="match-type">Match Type:</label>
                <select id="match-type" onchange="setupMatchType()">
                    <option value="">Select Match Type</option>
                    <option value="2v2-best">2 vs 2 - Best Net Score</option>
                    <option value="2v2-combined">2 vs 2 - Combined Net Score</option>
                    <option value="1v1">1 vs 1 Individual</option>
                </select>
            </div>
            <div class="form-group">
                <label for="scorer-password">Scorer Password:</label>
                <input type="password" id="scorer-password" placeholder="Enter scoring password">
            </div>
            <button class="btn" onclick="verifyScorer()">Start Scoring</button>
            <div id="scorecard-container" class="hidden">
                <!-- Scorecard will be generated here -->
            </div>
        </div>

        <!-- Live Scoring Tab -->
        <div id="live-scoring" class="tab-content">
            <h2>Live Scoring</h2>
            <div id="live-matches-container">
                <p>No active matches. Start scoring in the Scorecard tab to see live updates here.</p>
            </div>
        </div>

        <!-- Overall Scoring Tab -->
        <div id="overall-scoring" class="tab-content">
            <h2>Overall Tournament Scoring</h2>
            <div class="form-group">
                <label for="mvp-select">Tournament MVP (No Fun Banning Access Only):</label>
                <select id="mvp-select">
                    <option value="">Select MVP</option>
                </select>
                <button class="btn" onclick="setMVP()">Set MVP</button>
            </div>
            
            <!-- MVP Leaderboard -->
            <div id="mvp-leaderboard" class="leaderboard">
                <h4>üèÜ MVP Leaderboard - Top 3 Candidates</h4>
                <div id="leaderboard-content">
                    <p>Leaderboard will update as rounds are completed</p>
                </div>
            </div>
            
            <h3>Tournament Match Results</h3>
            <div id="tournament-matches-container">
                <!-- Detailed match results will be displayed here -->
            </div>
            
            <h3>Overall Points Summary</h3>
            <div id="overall-scores-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Round</th>
                            <th>Team 1 Points</th>
                            <th>Team 2 Points</th>
                            <th>Max Points</th>
                        </tr>
                    </thead>
                    <tbody id="overall-scores-body">
                        <tr>
                            <td colspan="4">No completed rounds yet</td>
                        </tr>
                    </tbody>
                </table>
                <div style="text-align: center; margin: 2rem 0;">
                    <h3>221 Points Needed to Win</h3>
                    <div id="team-totals"></div>
                </div>
            </div>
        </div>

        <!-- Player Statistics Tab -->
        <div id="player-stats" class="tab-content">
            <h2>Player Statistics</h2>
            <div id="player-stats-container">
                <p>Player statistics will appear here after rounds are completed.</p>
            </div>
        </div>

        <!-- Tournament History Tab -->
        <div id="tournament-history" class="tab-content">
            <h2>Tournament History</h2>
            <button class="btn" onclick="finalizeTournament()">Finalize Current Tournament (No Fun Banning Access Only)</button>
            <div id="tournament-history-container">
                <p>Tournament history will appear here after tournaments are finalized.</p>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal" class="password-modal">
        <div class="modal-content">
            <h3>No Fun Banning Access Required</h3>
            <div class="form-group">
                <label for="admin-password">Enter No Fun Banning Password:</label>
                <input type="password" id="admin-password" placeholder="Password">
            </div>
            <button class="btn" onclick="verifyAdmin()">Submit</button>
            <button class="btn btn-danger" onclick="closePasswordModal()">Cancel</button>
        </div>
    </div>

    <script>
        // Global variables
        let courses = JSON.parse(localStorage.getItem('courses') || '[]');
        let teams = JSON.parse(localStorage.getItem('teams') || '[]');
        let rounds = JSON.parse(localStorage.getItem('rounds') || '[]');
        let tournaments = JSON.parse(localStorage.getItem('tournaments') || '[]');
        let playerPhotos = JSON.parse(localStorage.getItem('playerPhotos') || '{}');
        let matchSetups = JSON.parse(localStorage.getItem('matchSetups') || '{}');
        let currentUser = null;
        let currentRound = null;

        const ADMIN_PASSWORD = 'Pikes1623';
        const SCORER_PASSWORD = 'PikesGolf';

        // Photo handling functions
        function handlePhotoUpload(input, playerIndex) {
            console.log('Photo upload triggered for player', playerIndex); // Debug log
            
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Check file size (limit to 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Photo file is too large. Please choose a file under 5MB.');
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const photoData = e.target.result;
                        const preview = document.getElementById(`photo-preview-${playerIndex}`);
                        
                        if (preview) {
                            preview.innerHTML = `<img src="${photoData}" alt="Player photo">`;
                        }
                        
                        // Store photo temporarily
                        if (!window.tempPhotos) window.tempPhotos = {};
                        window.tempPhotos[playerIndex] = photoData;
                        
                        console.log(`Photo processed for player ${playerIndex}`); // Debug log
                    } catch (error) {
                        console.error('Error processing photo:', error);
                        alert('Error processing photo. Please try again.');
                    }
                };
                
                reader.onerror = function() {
                    console.error('Error reading file');
                    alert('Error reading photo file. Please try again.');
                };
                
                reader.readAsDataURL(file);
            }
        }

        function savePlayerPhoto(playerName, photoData) {
            try {
                if (photoData && playerName) {
                    if (!playerPhotos) {
                        playerPhotos = {};
                    }
                    playerPhotos[playerName] = photoData;
                    localStorage.setItem('playerPhotos', JSON.stringify(playerPhotos));
                    console.log(`Photo saved for ${playerName}`); // Debug log
                    return true;
                }
            } catch (error) {
                console.error('Error saving player photo:', error);
                return false;
            }
            return false;
        }

        // Match Setup Functions
        function loadRoundTemplate() {
            const roundName = document.getElementById('setup-round-name').value;
            const matchTypeSelect = document.getElementById('setup-match-type');
            
            // Set default match type based on round
            if (roundName === 'Saturday AM') {
                matchTypeSelect.value = '1v1';
            } else if (roundName === 'Alternate Shot') {
                matchTypeSelect.value = 'alternate-shot';
            } else {
                matchTypeSelect.value = '2v2-best'; // Default for other rounds
            }
            
            updateMatchSetup();
        }

        function updateMatchSetup() {
            const roundName = document.getElementById('setup-round-name').value;
            const matchType = document.getElementById('setup-match-type').value;
            const container = document.getElementById('match-setup-container');
            
            if (!roundName || !matchType) {
                container.innerHTML = '<p>Select a round and match type to set up matches.</p>';
                return;
            }
            
            if (teams.length < 2) {
                container.innerHTML = '<p>Please set up at least 2 teams before creating matches.</p>';
                return;
            }
            
            const team1 = teams[0];
            const team2 = teams[1];
            
            let html = `<h3>Setting up matches for ${roundName}</h3>`;
            
            if (matchType === '1v1') {
                html += create1v1MatchSetup(team1, team2, roundName);
            } else if (matchType === 'alternate-shot') {
                html += createAlternateShotSetup(team1, team2, roundName);
            } else {
                html += create2v2MatchSetup(team1, team2, roundName, matchType);
            }
            
            container.innerHTML = html;
        }

        function create2v2MatchSetup(team1, team2, roundName, matchType) {
            const scoringMethod = matchType === '2v2-best' ? 'Best Net Score (1 low net score per team)' : 'Combined Net Score (total of both net scores)';
            
            return `
                <div class="match-setup-card">
                    <div class="match-header">Team Match Setup - 2 vs 2</div>
                    <div style="background: var(--gold); color: var(--garnet); padding: 0.75rem; border-radius: 4px; margin: 0.5rem 0; text-align: center; font-weight: bold;">
                        <strong>Scoring Method:</strong> ${scoringMethod}
                    </div>
                    
                    <div class="form-group">
                        <label for="scoring-method-select">Choose Scoring Method:</label>
                        <select id="scoring-method-select" onchange="updateScoringMethod()">
                            <option value="2v2-best" ${matchType === '2v2-best' ? 'selected' : ''}>Best Net Score (1 low net score per team)</option>
                            <option value="2v2-combined" ${matchType === '2v2-combined' ? 'selected' : ''}>Combined Net Score (total of both net scores)</option>
                        </select>
                    </div>
                    
                    <div class="match-pairing">
                        <div class="team-side">
                            <h4>${team1.name}</h4>
                            <div class="player-selector">
                                <label>Player 1:</label>
                                <select id="team1-player1">
                                    <option value="">Select Player</option>
                                    ${team1.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                            <div class="player-selector">
                                <label>Player 2:</label>
                                <select id="team1-player2">
                                    <option value="">Select Player</option>
                                    ${team1.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        
                        <div class="vs-divider">VS</div>
                        
                        <div class="team-side">
                            <h4>${team2.name}</h4>
                            <div class="player-selector">
                                <label>Player 1:</label>
                                <select id="team2-player1">
                                    <option value="">Select Player</option>
                                    ${team2.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                            <div class="player-selector">
                                <label>Player 2:</label>
                                <select id="team2-player2">
                                    <option value="">Select Player</option>
                                    ${team2.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="scoring-explanation" style="background: #f8f9fa; border: 1px solid var(--garnet); border-radius: 4px; padding: 0.75rem; margin: 0.5rem 0;">
                        ${getScoringExplanation(matchType)}
                    </div>
                    
                    <div class="scorecard-group">
                        <strong>Scorecard Groups:</strong><br>
                        Note: These 4 players may be split across different scorecards during play
                    </div>
                </div>
            `;
        }

        function getScoringExplanation(matchType) {
            if (matchType === '2v2-best') {
                return `
                    <strong>Best Net Score Rules:</strong><br>
                    ‚Ä¢ Each hole: Compare the lowest net score from each team<br>
                    ‚Ä¢ Winner gets 1 point, loser gets 0 points<br>
                    ‚Ä¢ Ties: Each team gets 0.5 points<br>
                    ‚Ä¢ Example: Team 1 scores 4,5 (net) ‚Üí Team 1 score = 4<br>
                    ‚Ä¢ Team 2 scores 3,6 (net) ‚Üí Team 2 score = 3<br>
                    ‚Ä¢ Team 2 wins the hole (1 point)
                `;
            } else {
                return `
                    <strong>Combined Net Score Rules:</strong><br>
                    ‚Ä¢ Each hole: Add both net scores from each team<br>
                    ‚Ä¢ Compare total team scores<br>
                    ‚Ä¢ Lower total wins 1 point, higher total gets 0 points<br>
                    ‚Ä¢ Ties: Each team gets 0.5 points<br>
                    ‚Ä¢ Example: Team 1 scores 4,5 (net) ‚Üí Team 1 total = 9<br>
                    ‚Ä¢ Team 2 scores 3,6 (net) ‚Üí Team 2 total = 9<br>
                    ‚Ä¢ Tie: Each team gets 0.5 points
                `;
            }
        }

        function updateScoringMethod() {
            const newMethod = document.getElementById('scoring-method-select').value;
            document.getElementById('setup-match-type').value = newMethod;
            
            // Update explanation
            const explanationDiv = document.getElementById('scoring-explanation');
            if (explanationDiv) {
                explanationDiv.innerHTML = getScoringExplanation(newMethod);
            }
        }

        function create1v1MatchSetup(team1, team2, roundName) {
            let html = `<div class="match-setup-card">
                <div class="match-header">Individual Match Setup (8 Matches)</div>
                <p>Set up 8 individual matches between ${team1.name} and ${team2.name} players</p>`;
            
            for (let i = 1; i <= 8; i++) {
                html += `
                    <div class="match-pairing">
                        <div class="team-side">
                            <h5>Match ${i} - ${team1.name}</h5>
                            <div class="player-selector">
                                <select id="match${i}-team1-player">
                                    <option value="">Select Player</option>
                                    ${team1.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        
                        <div class="vs-divider">VS</div>
                        
                        <div class="team-side">
                            <h5>Match ${i} - ${team2.name}</h5>
                            <div class="player-selector">
                                <select id="match${i}-team2-player">
                                    <option value="">Select Player</option>
                                    ${team2.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="scorecard-group">
                        Scorecard Group ${Math.ceil(i/2)}: ${i % 2 === 1 ? 'Matches ' + i : 'and ' + i}
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        function createAlternateShotSetup(team1, team2, roundName) {
            return `
                <div class="match-setup-card">
                    <div class="match-header">Alternate Shot Setup</div>
                    <p><strong>Special Format:</strong> Each team plays as a pair, alternating shots</p>
                    
                    <div class="match-pairing">
                        <div class="team-side">
                            <h4>${team1.name} - Pair</h4>
                            <div class="player-selector">
                                <label>Player 1 (Tee shots on odd holes):</label>
                                <select id="team1-alt-player1">
                                    <option value="">Select Player</option>
                                    ${team1.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                            <div class="player-selector">
                                <label>Player 2 (Tee shots on even holes):</label>
                                <select id="team1-alt-player2">
                                    <option value="">Select Player</option>
                                    ${team1.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        
                        <div class="vs-divider">VS</div>
                        
                        <div class="team-side">
                            <h4>${team2.name} - Pair</h4>
                            <div class="player-selector">
                                <label>Player 1 (Tee shots on odd holes):</label>
                                <select id="team2-alt-player1">
                                    <option value="">Select Player</option>
                                    ${team2.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                            <div class="player-selector">
                                <label>Player 2 (Tee shots on even holes):</label>
                                <select id="team2-alt-player2">
                                    <option value="">Select Player</option>
                                    ${team2.players.map(p => `<option value="${p.name}">${p.name} (${p.handicap})</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="scorecard-group">
                        <strong>Scorecard:</strong> One score per hole per team (team's combined result)
                    </div>
                </div>
            `;
        }

        function saveMatchSetup() {
            const roundName = document.getElementById('setup-round-name').value;
            let matchType = document.getElementById('setup-match-type').value;
            
            // For 2v2 matches, get the actual selected scoring method
            if (matchType.startsWith('2v2')) {
                const scoringMethodSelect = document.getElementById('scoring-method-select');
                if (scoringMethodSelect) {
                    matchType = scoringMethodSelect.value;
                }
            }
            
            if (!roundName || !matchType) {
                alert('Please select round name and match type');
                return;
            }
            
            const matchSetup = {
                roundName: roundName,
                matchType: matchType,
                matches: []
            };
            
            if (matchType === '1v1') {
                // Collect individual match data
                for (let i = 1; i <= 8; i++) {
                    const team1Player = document.getElementById(`match${i}-team1-player`).value;
                    const team2Player = document.getElementById(`match${i}-team2-player`).value;
                    
                    if (team1Player && team2Player) {
                        matchSetup.matches.push({
                            matchNumber: i,
                            team1Player: team1Player,
                            team2Player: team2Player,
                            scorecardGroup: Math.ceil(i/2)
                        });
                    }
                }
            } else if (matchType === 'alternate-shot') {
                // Collect alternate shot data
                const team1Player1 = document.getElementById('team1-alt-player1').value;
                const team1Player2 = document.getElementById('team1-alt-player2').value;
                const team2Player1 = document.getElementById('team2-alt-player1').value;
                const team2Player2 = document.getElementById('team2-alt-player2').value;
                
                if (team1Player1 && team1Player2 && team2Player1 && team2Player2) {
                    matchSetup.matches.push({
                        team1: [team1Player1, team1Player2],
                        team2: [team2Player1, team2Player2]
                    });
                }
            } else {
                // Collect 2v2 match data
                const team1Player1 = document.getElementById('team1-player1').value;
                const team1Player2 = document.getElementById('team1-player2').value;
                const team2Player1 = document.getElementById('team2-player1').value;
                const team2Player2 = document.getElementById('team2-player2').value;
                
                if (team1Player1 && team1Player2 && team2Player1 && team2Player2) {
                    matchSetup.matches.push({
                        team1: [team1Player1, team1Player2],
                        team2: [team2Player1, team2Player2],
                        scoringMethod: matchType // Store the specific scoring method
                    });
                }
            }
            
            if (matchSetup.matches.length === 0) {
                alert('Please select players for the matches');
                return;
            }
            
            // Save match setup
            matchSetups[roundName] = matchSetup;
            localStorage.setItem('matchSetups', JSON.stringify(matchSetups));
            
            displaySavedMatchSetups();
            
            const scoringText = matchType === '2v2-best' ? 'Best Net Score' : 
                              matchType === '2v2-combined' ? 'Combined Net Score' : 
                              matchType;
            alert(`Match setup saved for ${roundName}!\nScoring: ${scoringText}`);
        }

        function clearMatchSetup() {
            const roundName = document.getElementById('setup-round-name').value;
            if (roundName && confirm(`Clear match setup for ${roundName}?`)) {
                delete matchSetups[roundName];
                localStorage.setItem('matchSetups', JSON.stringify(matchSetups));
                displaySavedMatchSetups();
                updateMatchSetup();
                alert('Match setup cleared!');
            }
        }

        function displaySavedMatchSetups() {
            const container = document.getElementById('match-setups-list');
            container.innerHTML = '';
            
            Object.keys(matchSetups).forEach(roundName => {
                const setup = matchSetups[roundName];
                const setupDiv = document.createElement('div');
                setupDiv.className = 'match-setup-card';
                
                let matchInfo = '';
                let scoringInfo = '';
                
                if (setup.matchType === '1v1') {
                    matchInfo = `${setup.matches.length} individual matches set up`;
                    scoringInfo = 'Head-to-head individual matches';
                } else if (setup.matchType === 'alternate-shot') {
                    matchInfo = 'Alternate shot team match';
                    scoringInfo = 'One score per team (alternating shots)';
                } else if (setup.matchType === '2v2-best') {
                    matchInfo = '2v2 Team match';
                    scoringInfo = 'Best Net Score (1 low net score per team)';
                } else if (setup.matchType === '2v2-combined') {
                    matchInfo = '2v2 Team match';
                    scoringInfo = 'Combined Net Score (total of both net scores)';
                } else {
                    matchInfo = `Team match: ${setup.matchType}`;
                    scoringInfo = setup.matchType;
                }
                
                setupDiv.innerHTML = `
                    <h4>${roundName}</h4>
                    <p><strong>Format:</strong> ${matchInfo}</p>
                    <p><strong>Scoring:</strong> ${scoringInfo}</p>
                    <div style="background: var(--gold); color: var(--garnet); padding: 0.5rem; border-radius: 4px; margin: 0.5rem 0; font-weight: bold; text-align: center;">
                        ${getMatchSetupSummary(setup)}
                    </div>
                    <button class="btn" onclick="loadMatchSetup('${roundName}')">Load Setup</button>
                    <button class="btn btn-danger" onclick="deleteMatchSetup('${roundName}')">Delete</button>
                `;
                container.appendChild(setupDiv);
            });
            
            if (Object.keys(matchSetups).length === 0) {
                container.innerHTML = '<p>No match setups saved yet.</p>';
            }
        }

        function getMatchSetupSummary(setup) {
            if (setup.matchType === '1v1') {
                return `${setup.matches.length} individual matches configured`;
            } else if (setup.matchType === 'alternate-shot') {
                const match = setup.matches[0];
                return `${match.team1.join(' & ')} vs ${match.team2.join(' & ')}`;
            } else {
                const match = setup.matches[0];
                return `${match.team1.join(' & ')} vs ${match.team2.join(' & ')}`;
            }
        }

        function loadMatchSetup(roundName) {
            document.getElementById('setup-round-name').value = roundName;
            loadRoundTemplate();
            
            const setup = matchSetups[roundName];
            if (!setup) return;
            
            // Load the saved player selections
            setTimeout(() => {
                if (setup.matchType === '1v1') {
                    setup.matches.forEach(match => {
                        const team1Select = document.getElementById(`match${match.matchNumber}-team1-player`);
                        const team2Select = document.getElementById(`match${match.matchNumber}-team2-player`);
                        if (team1Select) team1Select.value = match.team1Player;
                        if (team2Select) team2Select.value = match.team2Player;
                    });
                } else if (setup.matchType === 'alternate-shot') {
                    const match = setup.matches[0];
                    if (match) {
                        document.getElementById('team1-alt-player1').value = match.team1[0];
                        document.getElementById('team1-alt-player2').value = match.team1[1];
                        document.getElementById('team2-alt-player1').value = match.team2[0];
                        document.getElementById('team2-alt-player2').value = match.team2[1];
                    }
                } else {
                    // Handle 2v2 matches
                    const match = setup.matches[0];
                    if (match) {
                        document.getElementById('team1-player1').value = match.team1[0];
                        document.getElementById('team1-player2').value = match.team1[1];
                        document.getElementById('team2-player1').value = match.team2[0];
                        document.getElementById('team2-player2').value = match.team2[1];
                        
                        // Set the scoring method
                        const scoringSelect = document.getElementById('scoring-method-select');
                        if (scoringSelect) {
                            scoringSelect.value = setup.matchType;
                            updateScoringMethod();
                        }
                    }
                }
            }, 100);
        }

        function deleteMatchSetup(roundName) {
            if (confirm(`Delete match setup for ${roundName}?`)) {
                delete matchSetups[roundName];
                localStorage.setItem('matchSetups', JSON.stringify(matchSetups));
                displaySavedMatchSetups();
            }
        }

        // Tab functionality
        function showTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Check if admin access is required
            if (['course-setup', 'team-setup', 'match-setup'].includes(tabId)) {
                checkAdminAccess(tabId);
            }
            
            // Refresh content
            refreshTabContent(tabId);
        }

        function checkAdminAccess(tabId) {
            if (currentUser !== 'admin') {
                document.getElementById('password-modal').style.display = 'block';
                document.getElementById('password-modal').dataset.targetTab = tabId;
            }
        }

        function verifyAdmin() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                currentUser = 'admin';
                closePasswordModal();
            } else {
                alert('Incorrect password');
            }
        }

        function closePasswordModal() {
            document.getElementById('password-modal').style.display = 'none';
            document.getElementById('admin-password').value = '';
            if (currentUser !== 'admin') {
                showTab('live-scoring');
            }
        }

        function verifyScorer() {
            const password = document.getElementById('scorer-password').value;
            if (password === SCORER_PASSWORD) {
                currentUser = 'scorer';
                setupScorecardEntry();
            } else {
                alert('Incorrect scorer password');
            }
        }

        // Course Setup Functions
        function generateHoles() {
            const container = document.getElementById('holes-container');
            container.innerHTML = `
                <h4>Front 9 (Holes 1-9)</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Hole</th>
                            ${Array.from({length: 9}, (_, i) => `<th>${i + 1}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Par</strong></td>
                            ${Array.from({length: 9}, (_, i) => `<td><input type="number" placeholder="Par" min="3" max="5" class="hole-par" data-hole="${i + 1}" style="width: 60px;"></td>`).join('')}
                        </tr>
                        <tr>
                            <td><strong>Handicap</strong></td>
                            ${Array.from({length: 9}, (_, i) => `<td><input type="number" placeholder="Hdcp" min="1" max="18" class="hole-handicap" data-hole="${i + 1}" style="width: 60px;"></td>`).join('')}
                        </tr>
                    </tbody>
                </table>
                
                <h4>Back 9 (Holes 10-18)</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Hole</th>
                            ${Array.from({length: 9}, (_, i) => `<th>${i + 10}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Par</strong></td>
                            ${Array.from({length: 9}, (_, i) => `<td><input type="number" placeholder="Par" min="3" max="5" class="hole-par" data-hole="${i + 10}" style="width: 60px;"></td>`).join('')}
                        </tr>
                        <tr>
                            <td><strong>Handicap</strong></td>
                            ${Array.from({length: 9}, (_, i) => `<td><input type="number" placeholder="Hdcp" min="1" max="18" class="hole-handicap" data-hole="${i + 10}" style="width: 60px;"></td>`).join('')}
                        </tr>
                    </tbody>
                </table>
            `;
        }

        function saveCourse() {
            const courseName = document.getElementById('course-name').value;
            const tournamentYear = document.getElementById('tournament-year').value;
            
            if (!courseName || !tournamentYear) {
                alert('Please enter course name and tournament year');
                return;
            }

            const holes = [];
            for (let i = 1; i <= 18; i++) {
                const par = document.querySelector(`.hole-par[data-hole="${i}"]`).value;
                const handicap = document.querySelector(`.hole-handicap[data-hole="${i}"]`).value;
                
                if (!par || !handicap) {
                    alert(`Please complete hole ${i} information`);
                    return;
                }
                
                holes.push({
                    number: i,
                    par: parseInt(par),
                    handicap: parseInt(handicap)
                });
            }

            const course = {
                id: Date.now(),
                name: courseName,
                year: parseInt(tournamentYear),
                holes: holes
            };

            courses.push(course);
            localStorage.setItem('courses', JSON.stringify(courses));
            displaySavedCourses();
            
            // Generate scorecards for all rounds
            generateAllScorecards(course);
            
            alert('Course saved successfully and scorecards generated!');
        }

        function generateAllScorecards(course) {
            // Create a comprehensive set of scorecard templates
            const scorecardTemplates = {
                course: course,
                rounds: [
                    { name: 'Thursday AM', type: '2v2-best', maxPoints: 18 },
                    { name: 'Thursday PM', type: '2v2-combined', maxPoints: 18 },
                    { name: 'Friday AM', type: '2v2-best', maxPoints: 18 },
                    { name: 'Friday PM', type: '2v2-combined', maxPoints: 18 },
                    { name: 'Saturday AM', type: '1v1', maxPoints: 8, matches: 8 },
                    { name: 'Saturday PM', type: '2v2-best', maxPoints: 18 }
                ],
                totalPoints: 440
            };
            
            // Save scorecard templates
            localStorage.setItem('scorecardTemplates', JSON.stringify(scorecardTemplates));
            
            // Generate printable scorecards
            generatePrintableScorecards(scorecardTemplates);
        }

        function generatePrintableScorecards(templates) {
            // Create a new window with all scorecard templates
            const scorecardWindow = window.open('', '_blank', 'width=1000,height=800,scrollbars=yes');
            
            let scorecardHTML = `
                <html>
                <head>
                    <title>${templates.course.name} - Brother Frank Cup Scorecards</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .scorecard { 
                            page-break-after: always; 
                            margin-bottom: 40px; 
                            border: 3px solid #782F40; 
                            padding: 20px;
                            border-radius: 10px;
                        }
                        .scorecard:last-child { page-break-after: avoid; }
                        .header { 
                            text-align: center; 
                            color: #782F40; 
                            margin-bottom: 20px;
                            background: linear-gradient(135deg, #FFD700, #FFA500);
                            padding: 15px;
                            border-radius: 8px;
                            border: 2px solid #782F40;
                        }
                        .course-info { 
                            display: flex; 
                            justify-content: space-between; 
                            margin-bottom: 20px;
                            background: #f8f9fa;
                            padding: 10px;
                            border-radius: 5px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin: 15px 0; 
                        }
                        th, td { 
                            border: 2px solid #782F40; 
                            padding: 8px; 
                            text-align: center; 
                            min-width: 35px;
                        }
                        th { 
                            background: #782F40; 
                            color: #FFD700; 
                            font-weight: bold; 
                        }
                        .hole-number { background: #FFD700; color: #782F40; font-weight: bold; }
                        .player-row { background: #f8f9fa; }
                        .net-row { background: #e9ecef; }
                        .points-row { background: #FFD700; color: #782F40; font-weight: bold; }
                        .match-info {
                            background: #782F40;
                            color: #FFD700;
                            padding: 10px;
                            border-radius: 5px;
                            margin: 10px 0;
                            text-align: center;
                            font-weight: bold;
                        }
                        .team-section {
                            border: 2px solid #782F40;
                            margin: 10px 0;
                            padding: 10px;
                            border-radius: 5px;
                        }
                        .signature-line {
                            border-top: 2px solid #782F40;
                            margin-top: 30px;
                            padding-top: 10px;
                            text-align: center;
                        }
                        @media print {
                            .scorecard { page-break-after: always; }
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
            `;

            // Generate team match scorecards
            templates.rounds.forEach(round => {
                if (round.type !== '1v1') {
                    scorecardHTML += generateTeamScorecardTemplate(templates.course, round);
                } else {
                    // Generate individual match scorecards
                    for (let i = 1; i <= round.matches; i++) {
                        scorecardHTML += generateIndividualScorecardTemplate(templates.course, round, i);
                    }
                }
            });

            scorecardHTML += `
                </body>
                </html>
            `;

            scorecardWindow.document.write(scorecardHTML);
            scorecardWindow.document.close();
        }

        function generateTeamScorecardTemplate(course, round) {
            return `
                <div class="scorecard">
                    <div class="header">
                        <h1>Brother Frank Cup</h1>
                        <h2>${course.name} (${course.year})</h2>
                    </div>
                    
                    <div class="match-info">
                        ${round.name} - ${round.type === '2v2-best' ? '2v2 Best Net Score' : '2v2 Combined Net Score'}
                        <br>Maximum Points: ${round.maxPoints}
                    </div>

                    <div class="course-info">
                        <div><strong>Date:</strong> _______________</div>
                        <div><strong>Weather:</strong> _______________</div>
                        <div><strong>Scorer:</strong> _______________</div>
                    </div>

                    <div class="team-section">
                        <h3>Team 1:</h3>
                        <p>Player 1: _________________________ Handicap: _____</p>
                        <p>Player 2: _________________________ Handicap: _____</p>
                    </div>

                    <div class="team-section">
                        <h3>Team 2:</h3>
                        <p>Player 1: _________________________ Handicap: _____</p>
                        <p>Player 2: _________________________ Handicap: _____</p>
                    </div>

                    <!-- Front 9 -->
                    <h3>Front 9</h3>
                    <table>
                        <tr class="hole-number">
                            <th>Hole</th>
                            ${course.holes.slice(0, 9).map(hole => `<th>${hole.number}</th>`).join('')}
                            <th>OUT</th>
                        </tr>
                        <tr>
                            <th>Par</th>
                            ${course.holes.slice(0, 9).map(hole => `<td>${hole.par}</td>`).join('')}
                            <td>${course.holes.slice(0, 9).reduce((sum, hole) => sum + hole.par, 0)}</td>
                        </tr>
                        <tr>
                            <th>Handicap</th>
                            ${course.holes.slice(0, 9).map(hole => `<td>${hole.handicap}</td>`).join('')}
                            <td>-</td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 1 P1</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 1 P2</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 2 P1</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 2 P2</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Team 1 Net</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Team 2 Net</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="points-row">
                            <th>Points</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                    </table>

                    <!-- Back 9 -->
                    <h3>Back 9</h3>
                    <table>
                        <tr class="hole-number">
                            <th>Hole</th>
                            ${course.holes.slice(9, 18).map(hole => `<th>${hole.number}</th>`).join('')}
                            <th>IN</th>
                            <th>TOTAL</th>
                        </tr>
                        <tr>
                            <th>Par</th>
                            ${course.holes.slice(9, 18).map(hole => `<td>${hole.par}</td>`).join('')}
                            <td>${course.holes.slice(9, 18).reduce((sum, hole) => sum + hole.par, 0)}</td>
                            <td>${course.holes.reduce((sum, hole) => sum + hole.par, 0)}</td>
                        </tr>
                        <tr>
                            <th>Handicap</th>
                            ${course.holes.slice(9, 18).map(hole => `<td>${hole.handicap}</td>`).join('')}
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 1 P1</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 1 P2</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 2 P1</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Team 2 P2</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Team 1 Net</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Team 2 Net</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="points-row">
                            <th>Points</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td><strong>TOTAL POINTS</strong></td>
                        </tr>
                    </table>

                    <div style="display: flex; justify-content: space-between; margin-top: 20px; font-weight: bold;">
                        <div>Team 1 Points: _______</div>
                        <div>Team 2 Points: _______</div>
                    </div>

                    <div class="signature-line">
                        <strong>Scorer Signature:</strong> _________________________ 
                        <strong>Date:</strong> _____________
                    </div>
                </div>
            `;
        }

        function generateIndividualScorecardTemplate(course, round, matchNumber) {
            return `
                <div class="scorecard">
                    <div class="header">
                        <h1>Brother Frank Cup</h1>
                        <h2>${course.name} (${course.year})</h2>
                    </div>
                    
                    <div class="match-info">
                        ${round.name} - Individual Match ${matchNumber}
                        <br>Maximum Points: 1 (Winner takes all)
                    </div>

                    <div class="course-info">
                        <div><strong>Date:</strong> _______________</div>
                        <div><strong>Weather:</strong> _______________</div>
                        <div><strong>Scorer:</strong> _______________</div>
                    </div>

                    <div class="team-section">
                        <h3>Match ${matchNumber} Players:</h3>
                        <p>Player 1: _________________________ Handicap: _____ Team: _________</p>
                        <p>Player 2: _________________________ Handicap: _____ Team: _________</p>
                    </div>

                    <!-- Front 9 -->
                    <h3>Front 9</h3>
                    <table>
                        <tr class="hole-number">
                            <th>Hole</th>
                            ${course.holes.slice(0, 9).map(hole => `<th>${hole.number}</th>`).join('')}
                            <th>OUT</th>
                        </tr>
                        <tr>
                            <th>Par</th>
                            ${course.holes.slice(0, 9).map(hole => `<td>${hole.par}</td>`).join('')}
                            <td>${course.holes.slice(0, 9).reduce((sum, hole) => sum + hole.par, 0)}</td>
                        </tr>
                        <tr>
                            <th>Handicap</th>
                            ${course.holes.slice(0, 9).map(hole => `<td>${hole.handicap}</td>`).join('')}
                            <td>-</td>
                        </tr>
                        <tr class="player-row">
                            <th>Player 1</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Player 2</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Player 1 Net</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Player 2 Net</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                        <tr class="points-row">
                            <th>Points</th>
                            ${course.holes.slice(0, 9).map(() => `<td></td>`).join('')}
                            <td></td>
                        </tr>
                    </table>

                    <!-- Back 9 -->
                    <h3>Back 9</h3>
                    <table>
                        <tr class="hole-number">
                            <th>Hole</th>
                            ${course.holes.slice(9, 18).map(hole => `<th>${hole.number}</th>`).join('')}
                            <th>IN</th>
                            <th>TOTAL</th>
                        </tr>
                        <tr>
                            <th>Par</th>
                            ${course.holes.slice(9, 18).map(hole => `<td>${hole.par}</td>`).join('')}
                            <td>${course.holes.slice(9, 18).reduce((sum, hole) => sum + hole.par, 0)}</td>
                            <td>${course.holes.reduce((sum, hole) => sum + hole.par, 0)}</td>
                        </tr>
                        <tr>
                            <th>Handicap</th>
                            ${course.holes.slice(9, 18).map(hole => `<td>${hole.handicap}</td>`).join('')}
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr class="player-row">
                            <th>Player 1</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="player-row">
                            <th>Player 2</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Player 1 Net</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="net-row">
                            <th>Player 2 Net</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="points-row">
                            <th>Points</th>
                            ${course.holes.slice(9, 18).map(() => `<td></td>`).join('')}
                            <td></td>
                            <td><strong>WINNER</strong></td>
                        </tr>
                    </table>

                    <div style="display: flex; justify-content: space-between; margin-top: 20px; font-weight: bold;">
                        <div>Player 1 Points: _______</div>
                        <div>Player 2 Points: _______</div>
                        <div>Match Winner: _____________</div>
                    </div>

                    <div class="signature-line">
                        <strong>Scorer Signature:</strong> _________________________ 
                        <strong>Date:</strong> _____________
                    </div>
                </div>
            `;
        }

        function deleteCourse() {
            if (confirm('Are you sure you want to delete the current course setup?')) {
                document.getElementById('course-name').value = '';
                document.getElementById('tournament-year').value = '';
                document.getElementById('holes-container').innerHTML = '';
            }
        }

        function displaySavedCourses() {
            const container = document.getElementById('saved-courses');
            container.innerHTML = '<h3>Saved Courses</h3>';
            
            courses.forEach(course => {
                const courseDiv = document.createElement('div');
                courseDiv.className = 'player-card';
                courseDiv.innerHTML = `
                    <h4>${course.name} (${course.year})</h4>
                    <button class="btn" onclick="loadCourse(${course.id})">Load</button>
                    <button class="btn btn-danger" onclick="removeCourse(${course.id})">Delete</button>
                `;
                container.appendChild(courseDiv);
            });
        }

        function loadCourse(courseId) {
            const course = courses.find(c => c.id === courseId);
            if (course) {
                document.getElementById('course-name').value = course.name;
                document.getElementById('tournament-year').value = course.year;
                generateHoles();
                
                course.holes.forEach(hole => {
                    document.querySelector(`.hole-par[data-hole="${hole.number}"]`).value = hole.par;
                    document.querySelector(`.hole-handicap[data-hole="${hole.number}"]`).value = hole.handicap;
                });
            }
        }

        function removeCourse(courseId) {
            if (confirm('Are you sure you want to delete this course?')) {
                courses = courses.filter(c => c.id !== courseId);
                localStorage.setItem('courses', JSON.stringify(courses));
                displaySavedCourses();
            }
        }

        // Team Setup Functions
        function saveTeam() {
            console.log('saveTeam function called'); // Debug log
            
            const teamName = document.getElementById('team-name').value;
            if (!teamName) {
                alert('Please enter team name');
                return;
            }

            const players = [];
            const playerCards = document.querySelectorAll('.player-card');
            
            console.log('Found player cards:', playerCards.length); // Debug log
            
            playerCards.forEach((card, index) => {
                const nameInput = card.querySelector('.player-name');
                const handicapInput = card.querySelector('.player-handicap');
                
                const name = nameInput ? nameInput.value.trim() : '';
                const handicap = handicapInput ? handicapInput.value : '';
                
                console.log(`Player ${index + 1}: ${name}, Handicap: ${handicap}`); // Debug log
                
                if (name && handicap) {
                    const player = {
                        name: name,
                        handicap: parseInt(handicap)
                    };
                    
                    // Save photo if uploaded (optional - won't block team saving)
                    try {
                        if (window.tempPhotos && window.tempPhotos[index]) {
                            const photoSaved = savePlayerPhoto(name, window.tempPhotos[index]);
                            if (photoSaved) {
                                player.hasPhoto = true;
                                console.log(`Photo saved for ${name}`); // Debug log
                            } else {
                                console.log(`Photo not saved for ${name}, continuing without photo`); // Debug log
                            }
                        } else {
                            console.log(`No photo provided for ${name}`); // Debug log
                        }
                    } catch (error) {
                        console.error('Error with photo for', name, error);
                        // Continue without photo - photos are optional
                    }
                    
                    players.push(player);
                } else {
                    if (!name) console.log(`Player ${index + 1}: Missing name`);
                    if (!handicap) console.log(`Player ${index + 1}: Missing handicap`);
                }
            });

            console.log('Players collected:', players.length); // Debug log

            if (players.length === 0) {
                alert('Please enter at least one player');
                return;
            }

            if (players.length < 4) {
                const proceed = confirm(`You've only entered ${players.length} player(s). Brother Frank Cup requires 4 players per team. Do you want to continue anyway?`);
                if (!proceed) {
                    return;
                }
            }

            const team = {
                id: Date.now(),
                name: teamName,
                players: players
            };

            console.log('Team object created:', team); // Debug log

            try {
                teams.push(team);
                localStorage.setItem('teams', JSON.stringify(teams));
                console.log('Team saved to localStorage'); // Debug log
                
                displaySavedTeams();
                
                // Clear temp photos
                if (window.tempPhotos) {
                    window.tempPhotos = {};
                }
                
                alert(`Team "${teamName}" saved successfully with ${players.length} player(s)!`);
            } catch (error) {
                console.error('Error saving team:', error);
                alert('Error saving team. Please try again.');
            }
        }

        function deleteTeam() {
            if (confirm('Are you sure you want to delete the current team setup?')) {
                document.getElementById('team-name').value = '';
                document.querySelectorAll('.player-name').forEach(input => input.value = '');
                document.querySelectorAll('.player-handicap').forEach(input => input.value = '');
            }
        }

        function displaySavedTeams() {
            const container = document.getElementById('saved-teams');
            container.innerHTML = '<h3>Saved Teams</h3>';
            
            teams.forEach(team => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'player-card';
                
                let playersHtml = '<ul>';
                team.players.forEach(player => {
                    const photo = getPlayerPhoto(player.name);
                    const photoHtml = photo ? `<img src="${photo}" class="player-photo-display" alt="${player.name}">` : '';
                    playersHtml += `<li style="display: flex; align-items: center; margin: 0.5rem 0;">${photoHtml}${player.name} (${player.handicap})</li>`;
                });
                playersHtml += '</ul>';
                
                teamDiv.innerHTML = `
                    <h4>${team.name}</h4>
                    ${playersHtml}
                    <button class="btn" onclick="loadTeam(${team.id})">Load</button>
                    <button class="btn btn-danger" onclick="removeTeam(${team.id})">Delete</button>
                `;
                container.appendChild(teamDiv);
            });
        }

        function loadTeam(teamId) {
            const team = teams.find(t => t.id === teamId);
            if (team) {
                document.getElementById('team-name').value = team.name;
                const playerCards = document.querySelectorAll('.player-card');
                
                team.players.forEach((player, index) => {
                    if (playerCards[index]) {
                        playerCards[index].querySelector('.player-name').value = player.name;
                        playerCards[index].querySelector('.player-handicap').value = player.handicap;
                        
                        // Load photo if available
                        const photo = getPlayerPhoto(player.name);
                        if (photo) {
                            const preview = document.getElementById(`photo-preview-${index}`);
                            if (preview) {
                                preview.innerHTML = `<img src="${photo}" alt="Player photo">`;
                            }
                        }
                    }
                });
            }
        }

        function removeTeam(teamId) {
            if (confirm('Are you sure you want to delete this team?')) {
                teams = teams.filter(t => t.id !== teamId);
                localStorage.setItem('teams', JSON.stringify(teams));
                displaySavedTeams();
            }
        }

        function deleteTeam() {
            if (confirm('Are you sure you want to delete the current team setup?')) {
                document.getElementById('team-name').value = '';
                document.querySelectorAll('.player-name').forEach(input => input.value = '');
                document.querySelectorAll('.player-handicap').forEach(input => input.value = '');
                
                // Clear photo previews
                for (let i = 0; i < 4; i++) {
                    const preview = document.getElementById(`photo-preview-${i}`);
                    if (preview) {
                        preview.innerHTML = '';
                    }
                }
                
                // Clear temp photos
                if (window.tempPhotos) {
                    window.tempPhotos = {};
                }
            }
        }

        // Scorecard Functions
        function setupMatchType() {
            const matchType = document.getElementById('match-type').value;
            // Setup will be completed when scorer is verified
        }

        function setupScorecardEntry() {
            const roundName = document.getElementById('round-name').value;
            const matchType = document.getElementById('match-type').value;
            
            if (!roundName || !matchType) {
                alert('Please enter round name and select match type');
                return;
            }

            if (courses.length === 0) {
                alert('Please set up a course first');
                return;
            }

            if (teams.length < 2) {
                alert('Please set up at least 2 teams first');
                return;
            }

            const container = document.getElementById('scorecard-container');
            container.classList.remove('hidden');
            
            // Use the most recent course
            const currentCourse = courses[courses.length - 1];
            
            if (matchType === '1v1') {
                setupIndividualMatches(container, currentCourse, roundName);
            } else {
                setupTeamMatches(container, currentCourse, roundName, matchType);
            }
        }

        function setupTeamMatches(container, course, roundName, matchType) {
            container.innerHTML = `
                <h3>${roundName} - ${matchType}</h3>
                <div class="form-group">
                    <label>Select Teams:</label>
                    <select id="team1-select">
                        ${teams.map(team => `<option value="${team.id}">${team.name}</option>`).join('')}
                    </select>
                    <select id="team2-select">
                        ${teams.map(team => `<option value="${team.id}">${team.name}</option>`).join('')}
                    </select>
                </div>
                <button class="btn" onclick="generateTeamScorecard('${roundName}', '${matchType}')">Generate Scorecard</button>
                <div id="team-scorecard-area"></div>
            `;
        }

        function setupIndividualMatches(container, course, roundName) {
            container.innerHTML = `
                <h3>${roundName} - Individual Matches</h3>
                <p>Setting up 8 individual matches...</p>
                <button class="btn" onclick="generateIndividualMatches('${roundName}')">Generate Individual Scorecards</button>
                <div id="individual-scorecard-area"></div>
            `;
        }

        function generateTeamScorecard(roundName, matchType) {
            const team1Id = document.getElementById('team1-select').value;
            const team2Id = document.getElementById('team2-select').value;
            
            if (team1Id === team2Id) {
                alert('Please select different teams');
                return;
            }

            const team1 = teams.find(t => t.id == team1Id);
            const team2 = teams.find(t => t.id == team2Id);
            const course = courses[courses.length - 1];

            const scorecardArea = document.getElementById('team-scorecard-area');
            scorecardArea.innerHTML = createTeamScorecardHTML(team1, team2, course, roundName, matchType);
        }

        function generateIndividualMatches(roundName) {
            const scorecardArea = document.getElementById('individual-scorecard-area');
            const course = courses[courses.length - 1];
            
            // For individual matches, we'll create 8 match pairings
            const allPlayers = [];
            teams.forEach(team => {
                team.players.forEach(player => {
                    allPlayers.push({...player, teamName: team.name});
                });
            });

            let html = '<h4>Individual Match Scorecards</h4>';
            for (let i = 0; i < 8; i++) {
                html += `
                    <div class="match-card">
                        <h5>Match ${i + 1}</h5>
                        <div class="form-group">
                            <label>Player 1:</label>
                            <select id="match${i}-player1">
                                ${allPlayers.map(p => `<option value="${p.name}">${p.name} (${p.teamName})</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Player 2:</label>
                            <select id="match${i}-player2">
                                ${allPlayers.map(p => `<option value="${p.name}">${p.name} (${p.teamName})</option>`).join('')}
                            </select>
                        </div>
                        <button class="btn" onclick="createIndividualScorecard(${i}, '${roundName}')">Create Scorecard</button>
                        <div id="individual-match-${i}-scorecard"></div>
                    </div>
                `;
            }
            
            scorecardArea.innerHTML = html;
        }

        function createTeamScorecardHTML(team1, team2, course, roundName, matchType) {
            let html = `
                <div class="match-card">
                    <h4>${team1.name} vs ${team2.name}</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Hole</th>
                                <th>Par</th>
                                <th>Handicap</th>
            `;
            
            // Add player columns
            team1.players.forEach(player => {
                html += `<th>${player.name} (${player.handicap})</th>`;
            });
            team2.players.forEach(player => {
                html += `<th>${player.name} (${player.handicap})</th>`;
            });
            
            html += `
                                <th>Team 1 Net</th>
                                <th>Team 2 Net</th>
                                <th>Points</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Add hole rows
            course.holes.forEach(hole => {
                html += `
                    <tr>
                        <td>${hole.number}</td>
                        <td>${hole.par}</td>
                        <td>${hole.handicap}</td>
                `;
                
                // Add input fields for each player
                team1.players.forEach(player => {
                    html += `<td><input type="number" class="scorecard-input" data-hole="${hole.number}" data-player="${player.name}" data-team="1" onchange="calculateHoleScore(${hole.number}, '${matchType}')" min="1" max="10"></td>`;
                });
                team2.players.forEach(player => {
                    html += `<td><input type="number" class="scorecard-input" data-hole="${hole.number}" data-player="${player.name}" data-team="2" onchange="calculateHoleScore(${hole.number}, '${matchType}')" min="1" max="10"></td>`;
                });
                
                html += `
                        <td id="team1-net-${hole.number}">-</td>
                        <td id="team2-net-${hole.number}">-</td>
                        <td id="points-${hole.number}">-</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="${3 + team1.players.length + team2.players.length}">Total Points</th>
                                <th id="team1-total">0</th>
                                <th id="team2-total">0</th>
                                <th id="total-points">0</th>
                            </tr>
                        </tfoot>
                    </table>
                    <button class="btn" onclick="saveRound('${roundName}', '${matchType}')">Save Round</button>
                    <button class="btn" onclick="completeRound('${roundName}', '${matchType}')">Complete Round</button>
                </div>
            `;

            return html;
        }

        function calculateHoleScore(holeNumber, matchType) {
            const course = courses[courses.length - 1];
            const hole = course.holes.find(h => h.number === holeNumber);
            
            // Get all scores for this hole
            const team1Scores = [];
            const team2Scores = [];
            
            document.querySelectorAll(`[data-hole="${holeNumber}"][data-team="1"]`).forEach(input => {
                if (input.value) {
                    const playerName = input.dataset.player;
                    const player = teams.flatMap(t => t.players).find(p => p.name === playerName);
                    const strokes = getStrokesForHole(player.handicap, hole.handicap);
                    const netScore = Math.max(1, parseInt(input.value) - strokes);
                    team1Scores.push(netScore);
                }
            });
            
            document.querySelectorAll(`[data-hole="${holeNumber}"][data-team="2"]`).forEach(input => {
                if (input.value) {
                    const playerName = input.dataset.player;
                    const player = teams.flatMap(t => t.players).find(p => p.name === playerName);
                    const strokes = getStrokesForHole(player.handicap, hole.handicap);
                    const netScore = Math.max(1, parseInt(input.value) - strokes);
                    team2Scores.push(netScore);
                }
            });

            // Calculate team scores based on match type
            let team1Net = 0;
            let team2Net = 0;
            
            if (matchType === '2v2-best') {
                team1Net = team1Scores.length > 0 ? Math.min(...team1Scores) : 0;
                team2Net = team2Scores.length > 0 ? Math.min(...team2Scores) : 0;
            } else if (matchType === '2v2-combined') {
                team1Net = team1Scores.reduce((a, b) => a + b, 0);
                team2Net = team2Scores.reduce((a, b) => a + b, 0);
            }

            // Apply max score of 10
            team1Net = Math.min(team1Net, 10);
            team2Net = Math.min(team2Net, 10);

            // Update display
            document.getElementById(`team1-net-${holeNumber}`).textContent = team1Net || '-';
            document.getElementById(`team2-net-${holeNumber}`).textContent = team2Net || '-';

            // Calculate points (1 point for win, 0.5 for tie)
            let points = '-';
            if (team1Net && team2Net) {
                if (team1Net < team2Net) {
                    points = '1-0';
                } else if (team2Net < team1Net) {
                    points = '0-1';
                } else {
                    points = '0.5-0.5';
                }
            }
            
            document.getElementById(`points-${holeNumber}`).textContent = points;
            
            // Update totals
            updateTotals();
        }

        function getStrokesForHole(playerHandicap, holeHandicap) {
            // Correct handicap calculation
            const strokesPerHole = Math.floor(playerHandicap / 18);
            const extraStrokes = playerHandicap % 18;
            
            // Player gets extra stroke if hole handicap is <= remainder
            return strokesPerHole + (holeHandicap <= extraStrokes ? 1 : 0);
        }

        function updateTotals() {
            let team1Total = 0;
            let team2Total = 0;
            
            for (let i = 1; i <= 18; i++) {
                const pointsText = document.getElementById(`points-${i}`)?.textContent;
                if (pointsText && pointsText !== '-') {
                    const [p1, p2] = pointsText.split('-').map(p => parseFloat(p));
                    team1Total += p1;
                    team2Total += p2;
                }
            }
            
            document.getElementById('team1-total').textContent = team1Total;
            document.getElementById('team2-total').textContent = team2Total;
            document.getElementById('total-points').textContent = team1Total + team2Total;
        }

        function saveRound(roundName, matchType) {
            // Save current round data
            const roundData = collectRoundData(roundName, matchType);
            
            // Find existing round or create new one
            const existingIndex = rounds.findIndex(r => r.name === roundName);
            if (existingIndex >= 0) {
                rounds[existingIndex] = roundData;
            } else {
                rounds.push(roundData);
            }
            
            localStorage.setItem('rounds', JSON.stringify(rounds));
            alert('Round saved successfully!');
        }

        function completeRound(roundName, matchType) {
            saveRound(roundName, matchType);
            
            // Mark round as complete
            const roundIndex = rounds.findIndex(r => r.name === roundName);
            if (roundIndex >= 0) {
                rounds[roundIndex].completed = true;
                localStorage.setItem('rounds', JSON.stringify(rounds));
            }
            
            // Update live scoring
            updateLiveScoring();
            updateOverallScoring();
            updatePlayerStats();
            
            alert('Round completed and saved!');
        }

        function collectRoundData(roundName, matchType) {
            const team1Total = parseFloat(document.getElementById('team1-total').textContent) || 0;
            const team2Total = parseFloat(document.getElementById('team2-total').textContent) || 0;
            
            // Collect all scores and stats
            const playerScores = {};
            
            document.querySelectorAll('.scorecard-input[data-player]').forEach(input => {
                if (input.value) {
                    const playerName = input.dataset.player;
                    const hole = parseInt(input.dataset.hole);
                    const score = parseInt(input.value);
                    
                    if (!playerScores[playerName]) {
                        playerScores[playerName] = [];
                    }
                    playerScores[playerName].push({hole, score});
                }
            });

            return {
                name: roundName,
                matchType: matchType,
                team1Points: team1Total,
                team2Points: team2Total,
                playerScores: playerScores,
                completed: false,
                timestamp: new Date().toISOString()
            };
        }

        function updateLiveScoring() {
            const container = document.getElementById('live-matches-container');
            container.innerHTML = '<h3>Current Matches</h3>';
            
            rounds.forEach(round => {
                const roundDiv = document.createElement('div');
                roundDiv.className = round.completed ? 'round-complete' : 'match-card';
                roundDiv.innerHTML = `
                    <h4>${round.name} ${round.completed ? '(COMPLETE)' : '(IN PROGRESS)'}</h4>
                    <p>Team 1: ${round.team1Points} points</p>
                    <p>Team 2: ${round.team2Points} points</p>
                    <p>Match Type: ${round.matchType}</p>
                `;
                container.appendChild(roundDiv);
            });
        }

        function updateOverallScoring() {
            const tbody = document.getElementById('overall-scores-body');
            tbody.innerHTML = '';
            
            let team1GrandTotal = 0;
            let team2GrandTotal = 0;
            
            rounds.forEach(round => {
                if (round.completed) {
                    const row = document.createElement('tr');
                    const maxPoints = round.matchType === '1v1' ? 8 : 18; // Adjust based on match type
                    
                    row.innerHTML = `
                        <td>${round.name}</td>
                        <td>${round.team1Points}</td>
                        <td>${round.team2Points}</td>
                        <td>${maxPoints}</td>
                    `;
                    tbody.appendChild(row);
                    
                    team1GrandTotal += round.team1Points;
                    team2GrandTotal += round.team2Points;
                }
            });
            
            // Add totals row
            const totalRow = document.createElement('tr');
            totalRow.style.fontWeight = 'bold';
            totalRow.style.backgroundColor = '#f8f9fa';
            totalRow.innerHTML = `
                <td>TOTAL</td>
                <td>${team1GrandTotal}</td>
                <td>${team2GrandTotal}</td>
                <td>440</td>
            `;
            tbody.appendChild(totalRow);
            
            // Update team totals display
            document.getElementById('team-totals').innerHTML = `
                <h4>Team 1: ${team1GrandTotal} points</h4>
                <h4>Team 2: ${team2GrandTotal} points</h4>
                ${team1GrandTotal >= 221 ? '<p style="color: var(--garnet); font-weight: bold;">üèÜ TEAM 1 WINS!</p>' : ''}
                ${team2GrandTotal >= 221 ? '<p style="color: var(--garnet); font-weight: bold;">üèÜ TEAM 2 WINS!</p>' : ''}
            `;
        }

        function updatePlayerStats() {
            const container = document.getElementById('player-stats-container');
            container.innerHTML = '<h3>Player Statistics</h3>';
            
            const allPlayers = {};
            
            // Initialize player stats
            teams.forEach(team => {
                team.players.forEach(player => {
                    allPlayers[player.name] = {
                        name: player.name,
                        handicap: player.handicap,
                        teamName: team.name,
                        rounds: [],
                        wins: 0,
                        losses: 0,
                        ties: 0,
                        eagles: 0,
                        birdies: 0,
                        pars: 0,
                        bogeys: 0,
                        doubleBogeys: 0,
                        tripleBogeys: 0,
                        quadrupleBogeys: 0,
                        others: 0,
                        holesInOne: 0
                    };
                });
            });
            
            // Process round data
            const course = courses[courses.length - 1];
            rounds.forEach(round => {
                if (round.completed && round.playerScores) {
                    // Calculate match results for win/loss tracking
                    if (round.matchType === '2v2-best' || round.matchType === '2v2-combined') {
                        // For team matches, all players on winning team get a win
                        const team1Players = [];
                        const team2Players = [];
                        
                        // Categorize players by team
                        Object.keys(round.playerScores).forEach(playerName => {
                            const playerTeam = teams.find(team => team.players.some(p => p.name === playerName));
                            if (playerTeam) {
                                if (playerTeam === teams[0]) {
                                    team1Players.push(playerName);
                                } else {
                                    team2Players.push(playerName);
                                }
                            }
                        });
                        
                        // Determine match result and update win/loss records
                        if (round.team1Points > round.team2Points) {
                            // Team 1 wins
                            team1Players.forEach(playerName => {
                                if (allPlayers[playerName]) allPlayers[playerName].wins++;
                            });
                            team2Players.forEach(playerName => {
                                if (allPlayers[playerName]) allPlayers[playerName].losses++;
                            });
                        } else if (round.team2Points > round.team1Points) {
                            // Team 2 wins
                            team2Players.forEach(playerName => {
                                if (allPlayers[playerName]) allPlayers[playerName].wins++;
                            });
                            team1Players.forEach(playerName => {
                                if (allPlayers[playerName]) allPlayers[playerName].losses++;
                            });
                        } else {
                            // Tie
                            [...team1Players, ...team2Players].forEach(playerName => {
                                if (allPlayers[playerName]) allPlayers[playerName].ties++;
                            });
                        }
                    } else if (round.matchType === '1v1') {
                        // For individual matches, track individual wins/losses
                        // This would need match-specific data that we'll implement when individual matches are properly tracked
                        // For now, we'll add this functionality when individual match data structure is enhanced
                    }
                    
                    // Process scoring statistics
                    Object.keys(round.playerScores).forEach(playerName => {
                        if (allPlayers[playerName]) {
                            const scores = round.playerScores[playerName];
                            let grossTotal = 0;
                            let netTotal = 0;
                            
                            scores.forEach(holeScore => {
                                grossTotal += holeScore.score;
                                const hole = course.holes.find(h => h.number === holeScore.hole);
                                const strokes = getStrokesForHole(allPlayers[playerName].handicap, hole.handicap);
                                const netScore = holeScore.score - strokes;
                                netTotal += Math.max(1, netScore);
                                
                                // Calculate statistics relative to par
                                const scoreToPar = holeScore.score - hole.par;
                                if (holeScore.score === 1) {
                                    allPlayers[playerName].holesInOne++;
                                } else if (scoreToPar <= -2) {
                                    allPlayers[playerName].eagles++;
                                } else if (scoreToPar === -1) {
                                    allPlayers[playerName].birdies++;
                                } else if (scoreToPar === 0) {
                                    allPlayers[playerName].pars++;
                                } else if (scoreToPar === 1) {
                                    allPlayers[playerName].bogeys++;
                                } else if (scoreToPar === 2) {
                                    allPlayers[playerName].doubleBogeys++;
                                } else if (scoreToPar === 3) {
                                    allPlayers[playerName].tripleBogeys++;
                                } else if (scoreToPar === 4) {
                                    allPlayers[playerName].quadrupleBogeys++;
                                } else if (scoreToPar > 4) {
                                    allPlayers[playerName].others++;
                                }
                            });
                            
                            allPlayers[playerName].rounds.push({
                                roundName: round.name,
                                grossScore: grossTotal,
                                netScore: netTotal
                            });
                        }
                    });
                }
            });
            
            // Display player stats
            Object.values(allPlayers).forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-card';
                
                const photo = getPlayerPhoto(player.name);
                const photoHtml = photo ? `<img src="${photo}" class="player-photo-display" alt="${player.name}">` : '';
                
                let roundsHtml = '';
                player.rounds.forEach(round => {
                    roundsHtml += `<p>${round.roundName}: Gross ${round.grossScore}, Net ${round.netScore}</p>`;
                });
                
                playerDiv.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        ${photoHtml}
                        <div>
                            <h4>${player.name} (${player.teamName}) - Handicap: ${player.handicap}</h4>
                            <p><strong>Match Record:</strong> ${player.wins}-${player.losses}-${player.ties} (W-L-T)</p>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${player.wins}</div>
                            <div class="stat-label">Wins</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.losses}</div>
                            <div class="stat-label">Losses</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.ties}</div>
                            <div class="stat-label">Ties</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.holesInOne}</div>
                            <div class="stat-label">Holes in One</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.eagles}</div>
                            <div class="stat-label">Eagles</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.birdies}</div>
                            <div class="stat-label">Birdies</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.pars}</div>
                            <div class="stat-label">Pars</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.bogeys}</div>
                            <div class="stat-label">Bogeys</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.doubleBogeys}</div>
                            <div class="stat-label">Double Bogeys</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.tripleBogeys}</div>
                            <div class="stat-label">Triple Bogeys</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.quadrupleBogeys}</div>
                            <div class="stat-label">Quadruple Bogeys</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${player.others}</div>
                            <div class="stat-label">Others (5+)</div>
                        </div>
                    </div>
                    <h5>Round Scores</h5>
                    ${roundsHtml || '<p>No completed rounds yet</p>'}
                `;
                container.appendChild(playerDiv);
            });
            
            // Update MVP dropdown
            updateMVPDropdown();
        }

        function updateMVPDropdown() {
            const select = document.getElementById('mvp-select');
            select.innerHTML = '<option value="">Select MVP</option>';
            
            teams.forEach(team => {
                team.players.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = `${player.name} (${team.name})`;
                    select.appendChild(option);
                });
            });
        }

        function setMVP() {
            if (currentUser !== 'admin') {
                checkAdminAccess('overall-scoring');
                return;
            }
            
            const mvpName = document.getElementById('mvp-select').value;
            if (mvpName) {
                localStorage.setItem('currentMVP', mvpName);
                alert(`${mvpName} has been set as Tournament MVP!`);
            }
        }

        function finalizeTournament() {
            if (currentUser !== 'admin') {
                checkAdminAccess('tournament-history');
                return;
            }
            
            if (!confirm('Are you sure you want to finalize this tournament? This cannot be undone.')) {
                return;
            }
            
            const tournamentYear = document.getElementById('tournament-year')?.value || new Date().getFullYear();
            const mvp = localStorage.getItem('currentMVP') || 'Not selected';
            
            const tournament = {
                id: Date.now(),
                year: tournamentYear,
                rounds: [...rounds],
                teams: [...teams],
                course: courses[courses.length - 1],
                mvp: mvp,
                finalizedDate: new Date().toISOString()
            };
            
            tournaments.push(tournament);
            localStorage.setItem('tournaments', JSON.stringify(tournaments));
            
            // Clear current tournament data
            rounds = [];
            localStorage.removeItem('rounds');
            localStorage.removeItem('currentMVP');
            
            displayTournamentHistory();
            alert('Tournament finalized and saved to history!');
        }

        function displayTournamentHistory() {
            const container = document.getElementById('tournament-history-container');
            container.innerHTML = '<h3>Past Tournaments</h3>';
            
            tournaments.forEach(tournament => {
                const tournamentDiv = document.createElement('div');
                tournamentDiv.className = 'player-card';
                
                let team1Total = 0;
                let team2Total = 0;
                tournament.rounds.forEach(round => {
                    if (round.completed) {
                        team1Total += round.team1Points;
                        team2Total += round.team2Points;
                    }
                });
                
                const winner = team1Total > team2Total ? 'Team 1' : team2Total > team1Total ? 'Team 2' : 'Tie';
                
                // Get MVP photo
                const mvpPhoto = getPlayerPhoto(tournament.mvp);
                const mvpPhotoHtml = mvpPhoto ? `<img src="${mvpPhoto}" class="player-photo-display" alt="${tournament.mvp}">` : '';
                
                tournamentDiv.innerHTML = `
                    <h4>${tournament.year} Brother Frank Cup</h4>
                    <p><strong>Course:</strong> ${tournament.course?.name || 'Unknown'}</p>
                    <p><strong>Winner:</strong> ${winner} (${Math.max(team1Total, team2Total)} points)</p>
                    <p><strong>Final Score:</strong> Team 1: ${team1Total}, Team 2: ${team2Total}</p>
                    <div style="display: flex; align-items: center; margin: 0.5rem 0;">
                        ${mvpPhotoHtml}
                        <span><strong>MVP:</strong> ${tournament.mvp}</span>
                    </div>
                    <p><strong>Finalized:</strong> ${new Date(tournament.finalizedDate).toLocaleDateString()}</p>
                    <button class="btn" onclick="viewTournamentDetails(${tournament.id})">View Details</button>
                `;
                container.appendChild(tournamentDiv);
            });
            
            if (tournaments.length === 0) {
                container.innerHTML += '<p>No finalized tournaments yet.</p>';
            }
        }

        function viewTournamentDetails(tournamentId) {
            const tournament = tournaments.find(t => t.id === tournamentId);
            if (!tournament) return;
            
            const detailsWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
            
            // Calculate win/loss records for this tournament
            const playerRecords = {};
            
            // Initialize player records
            tournament.teams.forEach(team => {
                team.players.forEach(player => {
                    playerRecords[player.name] = {
                        name: player.name,
                        teamName: team.name,
                        wins: 0,
                        losses: 0,
                        ties: 0
                    };
                });
            });
            
            // Calculate match results
            tournament.rounds.forEach(round => {
                if (round.completed && round.playerScores) {
                    if (round.matchType === '2v2-best' || round.matchType === '2v2-combined') {
                        const team1Players = [];
                        const team2Players = [];
                        
                        // Categorize players by team
                        Object.keys(round.playerScores).forEach(playerName => {
                            const playerTeam = tournament.teams.find(team => team.players.some(p => p.name === playerName));
                            if (playerTeam) {
                                if (playerTeam === tournament.teams[0]) {
                                    team1Players.push(playerName);
                                } else {
                                    team2Players.push(playerName);
                                }
                            }
                        });
                        
                        // Update win/loss records
                        if (round.team1Points > round.team2Points) {
                            team1Players.forEach(playerName => {
                                if (playerRecords[playerName]) playerRecords[playerName].wins++;
                            });
                            team2Players.forEach(playerName => {
                                if (playerRecords[playerName]) playerRecords[playerName].losses++;
                            });
                        } else if (round.team2Points > round.team1Points) {
                            team2Players.forEach(playerName => {
                                if (playerRecords[playerName]) playerRecords[playerName].wins++;
                            });
                            team1Players.forEach(playerName => {
                                if (playerRecords[playerName]) playerRecords[playerName].losses++;
                            });
                        } else {
                            [...team1Players, ...team2Players].forEach(playerName => {
                                if (playerRecords[playerName]) playerRecords[playerName].ties++;
                            });
                        }
                    }
                }
            });
            
            // Generate player details with photos and records
            let teamDetailsHtml = '';
            tournament.teams.forEach(team => {
                teamDetailsHtml += `<h4>${team.name}</h4><ul>`;
                team.players.forEach(player => {
                    const photo = getPlayerPhoto(player.name);
                    const photoHtml = photo ? `<img src="${photo}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover; border: 2px solid #782F40;">` : '';
                    const record = playerRecords[player.name];
                    const recordText = record ? ` | Record: ${record.wins}-${record.losses}-${record.ties}` : '';
                    teamDetailsHtml += `<li style="display: flex; align-items: center; margin: 0.5rem 0;">${photoHtml}${player.name} (Handicap: ${player.handicap}${recordText})</li>`;
                });
                teamDetailsHtml += '</ul>';
            });
            
            detailsWindow.document.write(`
                <html>
                <head>
                    <title>${tournament.year} Brother Frank Cup Details</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th, td { border: 1px solid #782F40; padding: 8px; text-align: center; }
                        th { background: #782F40; color: #FFD700; }
                        h1, h2 { color: #782F40; }
                        .mvp-section { display: flex; align-items: center; margin: 20px 0; }
                        .mvp-photo { width: 60px; height: 60px; border-radius: 50%; margin-right: 15px; border: 3px solid #782F40; object-fit: cover; }
                        .records-table { margin: 20px 0; }
                        .records-table th { background: #FFD700; color: #782F40; }
                    </style>
                </head>
                <body>
                    <h1>${tournament.year} Brother Frank Cup - Tournament Details</h1>
                    <h2>Course: ${tournament.course?.name || 'Unknown'}</h2>
                    
                    <div class="mvp-section">
                        ${getPlayerPhoto(tournament.mvp) ? `<img src="${getPlayerPhoto(tournament.mvp)}" class="mvp-photo" alt="${tournament.mvp}">` : ''}
                        <div>
                            <h2>üèÜ MVP: ${tournament.mvp}</h2>
                        </div>
                    </div>
                    
                    <h3>Round Results</h3>
                    <table>
                        <tr><th>Round</th><th>Team 1 Points</th><th>Team 2 Points</th><th>Status</th></tr>
                        ${tournament.rounds.map(round => `
                            <tr>
                                <td>${round.name}</td>
                                <td>${round.team1Points}</td>
                                <td>${round.team2Points}</td>
                                <td>${round.completed ? 'Complete' : 'Incomplete'}</td>
                            </tr>
                        `).join('')}
                    </table>
                    
                    <h3>Player Records</h3>
                    <table class="records-table">
                        <tr><th>Player</th><th>Team</th><th>Wins</th><th>Losses</th><th>Ties</th><th>Record</th></tr>
                        ${Object.values(playerRecords).map(player => `
                            <tr>
                                <td>${player.name}</td>
                                <td>${player.teamName}</td>
                                <td>${player.wins}</td>
                                <td>${player.losses}</td>
                                <td>${player.ties}</td>
                                <td>${player.wins}-${player.losses}-${player.ties}</td>
                            </tr>
                        `).join('')}
                    </table>
                    
                    <h3>Teams</h3>
                    ${teamDetailsHtml}
                </body>
                </html>
            `);
        }

        function refreshTabContent(tabId) {
            switch(tabId) {
                case 'course-setup':
                    displaySavedCourses();
                    break;
                case 'team-setup':
                    displaySavedTeams();
                    break;
                case 'match-setup':
                    displaySavedMatchSetups();
                    break;
                case 'live-scoring':
                    updateLiveScoring();
                    break;
                case 'overall-scoring':
                    updateOverallScoring();
                    updateMVPDropdown();
                    break;
                case 'player-stats':
                    updatePlayerStats();
                    break;
                case 'tournament-history':
                    displayTournamentHistory();
                    break;
            }
        }

        function createIndividualScorecard(matchIndex, roundName) {
            const player1Name = document.getElementById(`match${matchIndex}-player1`).value;
            const player2Name = document.getElementById(`match${matchIndex}-player2`).value;
            
            if (player1Name === player2Name) {
                alert('Please select different players');
                return;
            }
            
            const player1 = teams.flatMap(t => t.players).find(p => p.name === player1Name);
            const player2 = teams.flatMap(t => t.players).find(p => p.name === player2Name);
            const course = courses[courses.length - 1];
            
            const scorecardContainer = document.getElementById(`individual-match-${matchIndex}-scorecard`);
            scorecardContainer.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Hole</th>
                            <th>Par</th>
                            <th>Handicap</th>
                            <th>${player1.name} (${player1.handicap})</th>
                            <th>${player2.name} (${player2.handicap})</th>
                            <th>${player1.name} Net</th>
                            <th>${player2.name} Net</th>
                            <th>Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${course.holes.map(hole => `
                            <tr>
                                <td>${hole.number}</td>
                                <td>${hole.par}</td>
                                <td>${hole.handicap}</td>
                                <td><input type="number" class="scorecard-input" data-hole="${hole.number}" data-player="${player1.name}" data-match="${matchIndex}" onchange="calculateIndividualHoleScore(${hole.number}, ${matchIndex})" min="1" max="10"></td>
                                <td><input type="number" class="scorecard-input" data-hole="${hole.number}" data-player="${player2.name}" data-match="${matchIndex}" onchange="calculateIndividualHoleScore(${hole.number}, ${matchIndex})" min="1" max="10"></td>
                                <td id="player1-net-${matchIndex}-${hole.number}">-</td>
                                <td id="player2-net-${matchIndex}-${hole.number}">-</td>
                                <td id="points-${matchIndex}-${hole.number}">-</td>
                            </tr>
                        `).join('')}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="5">Total Points</th>
                            <th id="player1-total-${matchIndex}">0</th>
                            <th id="player2-total-${matchIndex}">0</th>
                            <th id="total-points-${matchIndex}">0</th>
                        </tr>
                    </tfoot>
                </table>
                <button class="btn" onclick="saveIndividualMatch(${matchIndex}, '${roundName}')">Save Match</button>
                <button class="btn" onclick="completeIndividualMatch(${matchIndex}, '${roundName}')">Complete Match</button>
            `;
        }

        function calculateIndividualHoleScore(holeNumber, matchIndex) {
            const course = courses[courses.length - 1];
            const hole = course.holes.find(h => h.number === holeNumber);
            
            const player1Input = document.querySelector(`[data-hole="${holeNumber}"][data-match="${matchIndex}"]`);
            const player2Input = document.querySelectorAll(`[data-hole="${holeNumber}"][data-match="${matchIndex}"]`)[1];
            
            if (!player1Input?.value || !player2Input?.value) return;
            
            const player1Name = player1Input.dataset.player;
            const player2Name = player2Input.dataset.player;
            
            const player1 = teams.flatMap(t => t.players).find(p => p.name === player1Name);
            const player2 = teams.flatMap(t => t.players).find(p => p.name === player2Name);
            
            const player1Strokes = getStrokesForHole(player1.handicap, hole.handicap);
            const player2Strokes = getStrokesForHole(player2.handicap, hole.handicap);
            
            const player1Net = Math.max(1, parseInt(player1Input.value) - player1Strokes);
            const player2Net = Math.max(1, parseInt(player2Input.value) - player2Strokes);
            
            // Apply max score of 10
            const player1NetFinal = Math.min(player1Net, 10);
            const player2NetFinal = Math.min(player2Net, 10);
            
            document.getElementById(`player1-net-${matchIndex}-${holeNumber}`).textContent = player1NetFinal;
            document.getElementById(`player2-net-${matchIndex}-${holeNumber}`).textContent = player2NetFinal;
            
            // Calculate points
            let points = '-';
            if (player1NetFinal < player2NetFinal) {
                points = '1-0';
            } else if (player2NetFinal < player1NetFinal) {
                points = '0-1';
            } else {
                points = '0.5-0.5';
            }
            
            document.getElementById(`points-${matchIndex}-${holeNumber}`).textContent = points;
            
            updateIndividualTotals(matchIndex);
        }

        function updateIndividualTotals(matchIndex) {
            let player1Total = 0;
            let player2Total = 0;
            
            for (let i = 1; i <= 18; i++) {
                const pointsText = document.getElementById(`points-${matchIndex}-${i}`)?.textContent;
                if (pointsText && pointsText !== '-') {
                    const [p1, p2] = pointsText.split('-').map(p => parseFloat(p));
                    player1Total += p1;
                    player2Total += p2;
                }
            }
            
            document.getElementById(`player1-total-${matchIndex}`).textContent = player1Total;
            document.getElementById(`player2-total-${matchIndex}`).textContent = player2Total;
            document.getElementById(`total-points-${matchIndex}`).textContent = player1Total + player2Total;
        }

        function saveIndividualMatch(matchIndex, roundName) {
            // Implementation for saving individual match
            alert('Individual match saved!');
        }

        function completeIndividualMatch(matchIndex, roundName) {
            saveIndividualMatch(matchIndex, roundName);
            alert('Individual match completed!');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Generate initial holes setup
            if (document.getElementById('holes-container').children.length === 0) {
                generateHoles();
            }
            
            // Load saved data
            refreshTabContent('course-setup');
            
            // Set current year as default
            const currentYear = new Date().getFullYear();
            document.getElementById('tournament-year').value = currentYear;
        });

        // Handle browser back/forward
        window.addEventListener('popstate', function() {
            // Handle navigation if needed
        });

        // Mobile optimization
        if (window.innerWidth <= 768) {
            document.addEventListener('touchstart', function() {
                // Enable touch interactions
            });
        }

        // Export functions for debugging
        window.debugFunctions = {
            courses: () => courses,
            teams: () => teams,
            rounds: () => rounds,
            tournaments: () => tournaments,
            clearAll: () => {
                localStorage.clear();
                location.reload();
            }
        };
    </script>
</body>
</html>
