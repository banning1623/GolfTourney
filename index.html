<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Golf Scorecard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #782F40 0%, #8B1538 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #782F40 0%, #8B1538 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            border-bottom-color: #782F40;
            color: #782F40;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .setup-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #782F40;
        }

        .setup-section h3 {
            color: #782F40;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .course-setup {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 20px;
            align-items: end;
            margin-bottom: 25px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input, .input-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #782F40;
            box-shadow: 0 0 0 3px rgba(120, 47, 64, 0.1);
        }

        .match-format-section {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #4CAF50;
        }

        .match-format-section h4 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .format-option {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .format-option:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
        }

        .format-option.selected {
            border-color: #4CAF50;
            background: #f1f8e9;
        }

        .format-option input[type="radio"] {
            margin-right: 10px;
        }

        .format-title {
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .format-description {
            font-size: 0.9rem;
            color: #666;
        }

        .hole-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .hole-input-group {
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .hole-input-group:hover {
            border-color: #782F40;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .hole-input-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }

        .hole-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .hole-input:focus {
            outline: none;
            border-color: #782F40;
            background: #fdf7f0;
        }

        .teams-setup {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .team-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .team-card:hover {
            border-color: #782F40;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .team-header h4 {
            color: #782F40;
            font-size: 1.3rem;
            margin: 0;
        }

        .team-vs {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            border: none;
        }

        .player-inputs {
            display: grid;
            gap: 15px;
        }

        .player-row {
            display: grid;
            grid-template-columns: 2fr 80px auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-input {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .player-input:focus {
            outline: none;
            border-color: #782F40;
            background: #fdf7f0;
        }

        .handicap-input {
            text-align: center;
            font-weight: 600;
        }

        .player-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #782F40;
            margin: 5px;
        }

        .action-btn {
            background: linear-gradient(135deg, #782F40 0%, #8B1538 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(120, 47, 64, 0.3);
        }

        .add-team-btn {
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            color: #212529;
        }

        .delete-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .scorecard-container {
            overflow-x: auto;
            margin: 25px 0;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .scorecard {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
            background: white;
        }

        .scorecard th {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 15px 8px;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid #34495e;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 0.9rem;
        }

        .scorecard td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
            transition: background-color 0.3s ease;
            font-size: 0.9rem;
        }

        .scorecard tbody tr:hover {
            background: #f8f9fa;
        }

        .player-name-cell {
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            color: #212529;
            font-weight: 600;
            text-align: left;
            padding-left: 15px;
            min-width: 150px;
        }

        .team-label-cell {
            background: linear-gradient(135deg, #782F40 0%, #8B1538 100%);
            color: white;
            font-weight: 600;
            text-align: center;
            font-size: 1rem;
        }

        .hole-info-cell {
            background: #ecf0f1;
            font-weight: 600;
            color: #2c3e50;
        }

        .par-cell {
            background: linear-gradient(135deg, #782F40 0%, #8B1538 100%);
            color: white;
            font-weight: 600;
        }

        .handicap-cell {
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            color: #212529;
            font-weight: 600;
        }

        .gross-score-cell {
            background: #ffffff;
        }

        .net-score-cell {
            background: #fff8dc;
            font-weight: 600;
            color: #8B4513;
        }

        .stroke-hole {
            background: #fff3cd !important;
            border: 2px solid #FFD700 !important;
        }

        .score-input {
            width: 50px;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .score-input:focus {
            outline: none;
            border-color: #782F40;
            background: #fdf7f0;
        }

        .total-cell {
            background: linear-gradient(135deg, #782F40 0%, #8B1538 100%) !important;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .match-play-scorecard {
            margin-top: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #4CAF50;
        }

        .match-play-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .match-play-header h3 {
            margin: 0;
            font-size: 1.4rem;
        }

        .match-play-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .match-play-table th {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .match-play-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
        }

        .hole-winner {
            background: #c8e6c9 !important;
            font-weight: bold;
            color: #2e7d32;
        }

        .hole-tie {
            background: #fff3e0 !important;
            font-weight: bold;
            color: #f57c00;
        }

        .nine-hole-bonus {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%) !important;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .match-summary {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #4CAF50;
        }

        .match-summary h4 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-card {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .summary-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .pairing-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }

        .pairing-section h4 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .pairing-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .pairing-team {
            text-align: center;
        }

        .pairing-players {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .pairing-player {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-weight: 600;
        }

        .pairing-vs {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .course-setup {
                grid-template-columns: 1fr;
            }
            
            .teams-setup {
                grid-template-columns: 1fr;
            }
            
            .hole-grid {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                gap: 10px;
            }
            
            .scorecard th,
            .scorecard td {
                padding: 8px 4px;
                font-size: 0.8rem;
            }
            
            .score-input {
                width: 40px;
                padding: 6px;
                font-size: 0.9rem;
            }

            .pairing-grid {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏌️‍♂️ The Brother Frank Cup</h1>
            <p>Professional Tournament Management • Match Play Competition</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('setup')">Course Setup</button>
            <button class="tab" onclick="showTab('teams')">Team Setup</button>
            <button class="tab" onclick="showTab('scorecard')">Scorecard</button>
            <button class="tab" onclick="showTab('matchplay')">Live Scoring</button>
            <button class="tab" onclick="showTab('results')">Results</button>
        </div>

        <!-- Course Setup Tab -->
        <div id="setup" class="tab-content active">
            <div class="setup-section">
                <h3>🏌️ Course Information</h3>
                <div class="course-setup">
                    <div class="input-group">
                        <label>Course Name:</label>
                        <input type="text" id="courseName" value="Golf Course" placeholder="Enter course name">
                    </div>
                    <div class="input-group">
                        <label>Number of Holes:</label>
                        <select id="numHoles" onchange="setupHoles()">
                            <option value="9">9 Holes</option>
                            <option value="18" selected>18 Holes</option>
                        </select>
                    </div>
                    <button class="action-btn" onclick="setupHoles()">Setup Holes</button>
                </div>
                
                <div id="validationMessage"></div>
                
                <h4 style="color: #782F40; margin: 25px 0 15px 0; font-size: 1.3rem;">Hole Configuration</h4>
                <div class="hole-grid" id="holeGrid">
                    <!-- Holes will be generated here -->
                </div>
            </div>

            <!-- Match Format Selection -->
            <div class="match-format-section">
                <h4>🎯 Match Play Format</h4>
                <p style="color: #666; margin-bottom: 15px;">Select how matches will be played and scored</p>
                
                <div class="format-options">
                    <div class="format-option selected" onclick="selectMatchFormat('2v2-total')">
                        <input type="radio" name="matchFormat" value="2v2-total" checked>
                        <div class="format-title">2v2 Total Net</div>
                        <div class="format-description">Both players' net scores added together per hole</div>
                    </div>
                    
                    <div class="format-option" onclick="selectMatchFormat('2v2-low')">
                        <input type="radio" name="matchFormat" value="2v2-low">
                        <div class="format-title">2v2 Low Net</div>
                        <div class="format-description">Best net score from each team per hole</div>
                    </div>
                    
                    <div class="format-option" onclick="selectMatchFormat('1v1')">
                        <input type="radio" name="matchFormat" value="1v1">
                        <div class="format-title">1v1 Match Play</div>
                        <div class="format-description">Individual head-to-head matches</div>
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong>Match Play Scoring:</strong><br>
                    • 2 points for winning a hole<br>
                    • 1 point for tying a hole<br>
                    • 2-point bonus for winning each 9-hole segment<br>
                    • 1 point each for tied 9-hole segments
                </div>
            </div>
        </div>

        <!-- Team Setup Tab -->
        <div id="teams" class="tab-content">
            <div class="setup-section">
                <h3>👥 Team Configuration</h3>
                <p style="margin-bottom: 20px; color: #666;">Set up your teams and match pairings for the selected format.</p>
                
                <div style="margin-bottom: 25px;">
                    <button class="action-btn add-team-btn" onclick="addTeamMatch()">+ Add Team Match</button>
                </div>
                
                <div id="teamsContainer">
                    <!-- Team cards will be generated here -->
                </div>
            </div>
        </div>

        <!-- Scorecard Tab -->
        <div id="scorecard" class="tab-content">
            <div id="scorecardContent">
                <!-- Scorecard will be generated here -->
            </div>
        </div>

        <!-- Live Scoring Tab -->
        <div id="matchplay" class="tab-content">
            <div id="matchPlayContent">
                <!-- Live scoring results will be generated here -->
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results" class="tab-content">
            <h2>Match Results & Standings</h2>
            <div id="resultsContent">
                <!-- Results will be calculated here -->
            </div>
        </div>
    </div>

    <script>
        // Course data
        let courseData = {
            name: 'Golf Course',
            holes: 18,
            par: [4, 5, 4, 3, 4, 5, 4, 3, 4, 4, 5, 4, 3, 4, 5, 4, 3, 4],
            handicaps: [5, 11, 1, 13, 17, 15, 3, 7, 9, 8, 16, 10, 4, 2, 18, 12, 14, 6],
            matchFormat: '2v2-total'
        };

        // Team matches data
        let teamMatches = [];

        // Scores data
        let scores = {};

        // Match play pairings
        let matchPairings = {};

        // Initialize
        function init() {
            setupHoles();
            setupDefaultTeams();
            
            // Load saved scores if they exist
            const savedScores = localStorage.getItem('currentScores');
            if (savedScores) {
                scores = JSON.parse(savedScores);
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'scorecard') {
                generateScorecard();
            } else if (tabName === 'matchplay') {
                generateMatchPlayView();
            } else if (tabName === 'results') {
                calculateResults();
            }
        }

        function selectMatchFormat(format) {
            courseData.matchFormat = format;
            
            // Update visual selection
            document.querySelectorAll('.format-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Update radio button
            document.querySelector(`input[value="${format}"]`).checked = true;
            
            // Regenerate teams based on new format
            setupDefaultTeams();
        }

        function setupHoles() {
            const numHoles = parseInt(document.getElementById('numHoles').value);
            const courseName = document.getElementById('courseName').value;
            
            courseData.name = courseName;
            courseData.holes = numHoles;
            
            // Adjust arrays if holes changed
            if (numHoles !== courseData.par.length) {
                if (numHoles === 9) {
                    courseData.par = [4, 5, 4, 3, 4, 5, 4, 3, 4];
                    courseData.handicaps = [1, 3, 5, 7, 9, 2, 4, 6, 8];
                } else {
                    courseData.par = [4, 5, 4, 3, 4, 5, 4, 3, 4, 4, 5, 4, 3, 4, 5, 4, 3, 4];
                    courseData.handicaps = [5, 11, 1, 13, 17, 15, 3, 7, 9, 8, 16, 10, 4, 2, 18, 12, 14, 6];
                }
            }
            
            renderHoleGrid();
            validateCourse();
        }

        function renderHoleGrid() {
            const grid = document.getElementById('holeGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < courseData.holes; i++) {
                const holeDiv = document.createElement('div');
                holeDiv.className = 'hole-input-group';
                holeDiv.innerHTML = `
                    <label style="color: #782F40; font-weight: 600;">Hole ${i + 1}</label>
                    <div style="margin-bottom: 8px;">
                        <label style="font-size: 0.8rem; color: #782F40; margin-bottom: 3px; display: block; font-weight: 600;">Par</label>
                        <input type="number" class="hole-input" value="${courseData.par[i]}" 
                               min="3" max="5" onchange="updatePar(${i}, this.value)"
                               style="border-color: #782F40; background: white;">
                    </div>
                    <div>
                        <label style="font-size: 0.8rem; color: #782F40; margin-bottom: 3px; display: block; font-weight: 600;">Net</label>
                        <input type="number" class="hole-input" value="${courseData.handicaps[i]}" 
                               min="1" max="${courseData.holes}" onchange="updateHandicap(${i}, this.value)"
                               style="border-color: #782F40; background: white;">
                    </div>
                `;
                grid.appendChild(holeDiv);
            }
        }

        function updatePar(holeIndex, value) {
            courseData.par[holeIndex] = parseInt(value) || 4;
            validateCourse();
        }

        function updateHandicap(holeIndex, value) {
            courseData.handicaps[holeIndex] = parseInt(value) || 1;
            validateCourse();
        }

        function validateCourse() {
            const validationDiv = document.getElementById('validationMessage');
            const errors = [];
            
            // Check par values
            const invalidPars = courseData.par.filter(par => par < 3 || par > 5);
            if (invalidPars.length > 0) {
                errors.push('Par values must be between 3 and 5');
            }
            
            // Check handicap uniqueness and range
            const handicapSet = new Set(courseData.handicaps);
            if (handicapSet.size !== courseData.holes) {
                errors.push('Each hole must have a unique handicap rating');
            }
            
            const validRange = Array.from({length: courseData.holes}, (_, i) => i + 1);
            const missingHandicaps = validRange.filter(h => !courseData.handicaps.includes(h));
            if (missingHandicaps.length > 0) {
                errors.push(`Missing handicap ratings: ${missingHandicaps.join(', ')}`);
            }
            
            if (errors.length > 0) {
                validationDiv.innerHTML = `<div style="background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #c62828;">${errors.join('<br>')}</div>`;
            } else {
                validationDiv.innerHTML = '';
            }
        }

        function setupDefaultTeams() {
            const playersPerTeam = getPlayersPerTeam();
            
            let team1Players = [];
            let team2Players = [];
            
            for (let i = 0; i < playersPerTeam; i++) {
                team1Players.push({name: `Player ${i + 1}`, handicap: 10 + (i * 5)});
                team2Players.push({name: `Player ${i + 1 + playersPerTeam}`, handicap: 12 + (i * 5)});
            }
            
            teamMatches = [
                {
                    id: 1,
                    team1Name: 'Team Alpha',
                    team2Name: 'Team Bravo',
                    team1: team1Players,
                    team2: team2Players
                }
            ];
            renderTeams();
        }

        function getPlayersPerTeam() {
            switch (courseData.matchFormat) {
                case '2v2-total':
                case '2v2-low':
                    return 2;
                case '1v1':
                    return 1;
                default:
                    return 2;
            }
        }

        function addTeamMatch() {
            const newId = Math.max(...teamMatches.map(t => t.id), 0) + 1;
            const playersPerTeam = getPlayersPerTeam();
            
            let team1Players = [];
            let team2Players = [];
            
            for (let i = 0; i < playersPerTeam; i++) {
                team1Players.push({name: '', handicap: 0});
                team2Players.push({name: '', handicap: 0});
            }
            
            teamMatches.push({
                id: newId,
                team1Name: '',
                team2Name: '',
                team1: team1Players,
                team2: team2Players
            });
            renderTeams();
        }

        function renderTeams() {
            const container = document.getElementById('teamsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            teamMatches.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'teams-setup';
                matchDiv.innerHTML = `
                    <div class="team-card">
                        <div class="team-header">
                            <input type="text" class="player-input" placeholder="Team Name" 
                                   value="${match.team1Name || ''}" 
                                   onchange="updateTeamName(${match.id}, 'team1Name', this.value)"
                                   style="font-size: 1.2rem; font-weight: 600; color: #782F40; background: transparent; border: 2px dashed #782F40; text-align: center;">
                            <button class="delete-btn" onclick="deleteTeamMatch(${match.id})">🗑️</button>
                        </div>
                        <div class="player-inputs">
                            ${renderTeamPlayers(match.id, 'team1', match.team1)}
                        </div>
                    </div>
                    
                    <div class="team-card">
                        <div class="team-header">
                            <input type="text" class="player-input" placeholder="Team Name" 
                                   value="${match.team2Name || ''}" 
                                   onchange="updateTeamName(${match.id}, 'team2Name', this.value)"
                                   style="font-size: 1.2rem; font-weight: 600; color: #2e8b57; background: transparent; border: 2px dashed #2e8b57; text-align: center;">
                            <span class="team-vs">VS</span>
                        </div>
                        <div class="player-inputs">
                            ${renderTeamPlayers(match.id, 'team2', match.team2)}
                        </div>
                    </div>
                `;
                container.appendChild(matchDiv);
            });

            // Add pairings section for match play
            if (courseData.matchFormat !== '1v1') {
                addPairingsSection();
            }
        }

        function renderTeamPlayers(matchId, teamName, players) {
            return players.map((player, index) => `
                <div class="player-row">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="player-photo" style="background: #e9ecef; display: flex; align-items: center; justify-content: center; color: #666;">👤</div>
                        <input type="text" class="player-input" placeholder="Player ${index + 1} Name" value="${player.name}"
                               onchange="updatePlayerName(${matchId}, '${teamName}', ${index}, this.value)">
                    </div>
                    <input type="number" class="player-input handicap-input" placeholder="HCP" value="${player.handicap || ''}"
                           min="0" max="54" onchange="updatePlayerHandicap(${matchId}, '${teamName}', ${index}, this.value)">
                    <div></div>
                </div>
            `).join('');
        }

        function addPairingsSection() {
            const container = document.getElementById('teamsContainer');
            const pairingsDiv = document.createElement('div');
            pairingsDiv.className = 'pairing-section';
            pairingsDiv.innerHTML = `
                <h4>🎯 Match Pairings for ${courseData.matchFormat.toUpperCase()}</h4>
                <p style="color: #666; margin-bottom: 15px;">These pairings will be used for match play scoring</p>
                <div id="pairingsGrid">
                    ${generatePairingsDisplay()}
                </div>
            `;
            container.appendChild(pairingsDiv);
        }

        function generatePairingsDisplay() {
            let html = '';
            teamMatches.forEach(match => {
                html += `
                    <div class="pairing-grid">
                        <div class="pairing-team">
                            <h5>${match.team1Name || 'Team A'}</h5>
                            <div class="pairing-players">
                                ${match.team1.map(player => `<div class="pairing-player">${player.name || 'Player'} (${player.handicap})</div>`).join('')}
                            </div>
                        </div>
                        <div class="pairing-vs">VS</div>
                        <div class="pairing-team">
                            <h5>${match.team2Name || 'Team B'}</h5>
                            <div class="pairing-players">
                                ${match.team2.map(player => `<div class="pairing-player">${player.name || 'Player'} (${player.handicap})</div>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            return html;
        }

        function updatePlayerName(matchId, teamName, playerIndex, name) {
            const match = teamMatches.find(m => m.id === matchId);
            match[teamName][playerIndex].name = name;
        }

        function updateTeamName(matchId, teamKey, name) {
            const match = teamMatches.find(m => m.id === matchId);
            match[teamKey] = name;
        }

        function updatePlayerHandicap(matchId, teamName, playerIndex, handicap) {
            const match = teamMatches.find(m => m.id === matchId);
            match[teamName][playerIndex].handicap = parseInt(handicap) || 0;
        }

        function deleteTeamMatch(matchId) {
            if (confirm('Delete this team match?')) {
                teamMatches = teamMatches.filter(m => m.id !== matchId);
                renderTeams();
                
                // Clean up scores
                Object.keys(scores).forEach(key => {
                    if (key.startsWith(`match${matchId}-`)) {
                        delete scores[key];
                    }
                });
            }
        }

        function calculateStrokesForHole(playerHandicap, holeHandicap) {
            const baseStrokes = Math.floor(playerHandicap / courseData.holes);
            const extraStrokes = playerHandicap % courseData.holes;
            
            const getsExtraStroke = holeHandicap <= extraStrokes;
            return baseStrokes + (getsExtraStroke ? 1 : 0);
        }

        function generateScorecard() {
            const container = document.getElementById('scorecardContent');
            if (!container) return;
            
            if (teamMatches.length === 0) {
                container.innerHTML = '<p>Please set up teams first in the Team Setup tab.</p>';
                return;
            }
            
            let html = `
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #2196f3;">
                    <h4 style="color: #1976d2; margin-bottom: 10px;">🏌️ ${courseData.matchFormat.toUpperCase()} Scorecard</h4>
                    <p style="color: #666;">Enter individual gross scores. Net scores and match play results will be calculated automatically.</p>
                </div>
            `;
            
            teamMatches.forEach((match, matchIndex) => {
                html += `
                    <h3 style="color: #782F40; margin: 30px 0 20px 0;">${match.team1Name || 'Team A'} vs ${match.team2Name || 'Team B'}</h3>
                    
                    <div class="scorecard-container">
                        <table class="scorecard">
                            <thead>
                                <tr>
                                    <th style="min-width: 150px;">Player</th>
                                    ${Array.from({length: courseData.holes}, (_, i) => `<th>${i + 1}</th>`).join('')}
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Course Info -->
                                <tr>
                                    <td class="hole-info-cell">Par</td>
                                    ${courseData.par.map(par => `<td class="par-cell">${par}</td>`).join('')}
                                    <td class="par-cell">${courseData.par.reduce((sum, par) => sum + par, 0)}</td>
                                </tr>
                                <tr>
                                    <td class="hole-info-cell">Handicap</td>
                                    ${courseData.handicaps.map(hcp => `<td class="handicap-cell">${hcp}</td>`).join('')}
                                    <td class="handicap-cell">-</td>
                                </tr>
                                
                                <!-- Team 1 -->
                                <tr>
                                    <td class="team-label-cell">${match.team1Name || 'TEAM A'}</td>
                                    ${Array.from({length: courseData.holes + 1}, () => '<td class="team-label-cell"></td>').join('')}
                                </tr>
                                
                                ${match.team1.map((player, playerIndex) => {
                                    const playerId = `match${match.id}-team1-${playerIndex}`;
                                    
                                    // Gross score row
                                    let grossRow = `<tr>
                                        <td class="player-name-cell">${player.name || 'Player'} (${player.handicap})</td>`;
                                    
                                    let grossTotal = 0;
                                    for (let hole = 1; hole <= courseData.holes; hole++) {
                                        const scoreKey = `${playerId}-hole${hole}`;
                                        const currentScore = scores[scoreKey] || '';
                                        grossRow += `<td class="gross-score-cell">
                                            <input type="number" class="score-input" 
                                                   value="${currentScore}" 
                                                   onchange="updateScore('${scoreKey}', this.value)"
                                                   min="1" max="15" placeholder="">
                                        </td>`;
                                        if (currentScore) grossTotal += parseInt(currentScore);
                                    }
                                    grossRow += `<td class="total-cell">${grossTotal || ''}</td></tr>`;
                                    
                                    // Net score row
                                    let netRow = `<tr>
                                        <td class="player-name-cell">${player.name || 'Player'} (Net)</td>`;
                                    
                                    let netTotal = 0;
                                    for (let hole = 1; hole <= courseData.holes; hole++) {
                                        const scoreKey = `${playerId}-hole${hole}`;
                                        const grossScore = scores[scoreKey];
                                        const holeHandicap = courseData.handicaps[hole - 1];
                                        const strokes = calculateStrokesForHole(player.handicap, holeHandicap);
                                        
                                        let netScore = '';
                                        let cellClass = 'net-score-cell';
                                        
                                        if (grossScore && !isNaN(grossScore)) {
                                            netScore = parseInt(grossScore) - strokes;
                                            netTotal += netScore;
                                        }
                                        
                                        if (strokes > 0) {
                                            cellClass += ' stroke-hole';
                                        }
                                        
                                        netRow += `<td class="${cellClass}" title="Gets ${strokes} stroke${strokes !== 1 ? 's' : ''}">${netScore}</td>`;
                                    }
                                    netRow += `<td class="total-cell">${netTotal || ''}</td></tr>`;
                                    
                                    return grossRow + netRow;
                                }).join('')}
                                
                                <!-- Team 2 -->
                                <tr>
                                    <td class="team-label-cell">${match.team2Name || 'TEAM B'}</td>
                                    ${Array.from({length: courseData.holes + 1}, () => '<td class="team-label-cell"></td>').join('')}
                                </tr>
                                
                                ${match.team2.map((player, playerIndex) => {
                                    const playerId = `match${match.id}-team2-${playerIndex}`;
                                    
                                    // Gross score row
                                    let grossRow = `<tr>
                                        <td class="player-name-cell">${player.name || 'Player'} (${player.handicap})</td>`;
                                    
                                    let grossTotal = 0;
                                    for (let hole = 1; hole <= courseData.holes; hole++) {
                                        const scoreKey = `${playerId}-hole${hole}`;
                                        const currentScore = scores[scoreKey] || '';
                                        grossRow += `<td class="gross-score-cell">
                                            <input type="number" class="score-input" value="${currentScore}" 
                                                   onchange="updateScore('${scoreKey}', this.value)"
                                                   min="1" max="15" placeholder="">
                                        </td>`;
                                        if (currentScore) grossTotal += parseInt(currentScore);
                                    }
                                    grossRow += `<td class="total-cell">${grossTotal || ''}</td></tr>`;
                                    
                                    // Net score row
                                    let netRow = `<tr>
                                        <td class="player-name-cell">${player.name || 'Player'} (Net)</td>`;
                                    
                                    let netTotal = 0;
                                    for (let hole = 1; hole <= courseData.holes; hole++) {
                                        const scoreKey = `${playerId}-hole${hole}`;
                                        const grossScore = scores[scoreKey];
                                        const holeHandicap = courseData.handicaps[hole - 1];
                                        const strokes = calculateStrokesForHole(player.handicap, holeHandicap);
                                        
                                        let netScore = '';
                                        let cellClass = 'net-score-cell';
                                        
                                        if (grossScore && !isNaN(grossScore)) {
                                            netScore = parseInt(grossScore) - strokes;
                                            netTotal += netScore;
                                        }
                                        
                                        if (strokes > 0) {
                                            cellClass += ' stroke-hole';
                                        }
                                        
                                        netRow += `<td class="${cellClass}" title="Gets ${strokes} stroke${strokes !== 1 ? 's' : ''}">${netScore}</td>`;
                                    }
                                    netRow += `<td class="total-cell">${netTotal || ''}</td></tr>`;
                                    
                                    return grossRow + netRow;
                                }).join('')}
                                
                            </tbody>
                        </table>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateScore(scoreKey, value) {
            if (value === '' || value === null) {
                delete scores[scoreKey];
            } else {
                scores[scoreKey] = parseInt(value);
            }
            generateScorecard(); // Refresh to update net scores and totals
            
            // Auto-save current scores
            localStorage.setItem('currentScores', JSON.stringify(scores));
        }

        function generateMatchPlayView() {
            const container = document.getElementById('matchPlayContent');
            if (!container) return;
            
            if (teamMatches.length === 0) {
                container.innerHTML = '<p>Please set up teams first in the Team Setup tab.</p>';
                return;
            }

            let html = `
                <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #4CAF50;">
                    <h4 style="color: #2e7d32; margin-bottom: 10px;">🎯 Match Play Results - ${courseData.matchFormat.toUpperCase()}</h4>
                    <p style="color: #666;">2 points for winning a hole, 1 point for tie. 2-point bonus for winning each 9-hole segment.</p>
                </div>
            `;

            teamMatches.forEach(match => {
                const matchResults = calculateMatchPlayResults(match);
                
                html += `
                    <div class="match-play-scorecard">
                        <div class="match-play-header">
                            <h3>${match.team1Name || 'Team A'} vs ${match.team2Name || 'Team B'}</h3>
                            <div>${courseData.matchFormat.toUpperCase()} Format</div>
                        </div>
                        
                        <table class="match-play-table">
                            <thead>
                                <tr>
                                    <th>Hole</th>
                                    <th>Par</th>
                                    <th>${match.team1Name || 'Team A'}</th>
                                    <th>${match.team2Name || 'Team B'}</th>
                                    <th>Winner</th>
                                    <th>Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${generateMatchPlayTable(match, matchResults)}
                            </tbody>
                        </table>
                        
                        ${generateMatchSummary(match, matchResults)}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function calculateMatchPlayResults(match) {
            const results = {
                holeResults: [],
                team1Points: 0,
                team2Points: 0,
                front9Team1: 0,
                front9Team2: 0,
                back9Team1: 0,
                back9Team2: 0
            };

            for (let hole = 1; hole <= courseData.holes; hole++) {
                const team1Score = calculateTeamScoreForHole(match, 'team1', hole);
                const team2Score = calculateTeamScoreForHole(match, 'team2', hole);
                
                let winner = '';
                let points = { team1: 0, team2: 0 };
                
                if (team1Score !== null && team2Score !== null) {
                    if (team1Score < team2Score) {
                        winner = match.team1Name || 'Team A';
                        points.team1 = 2;
                    } else if (team2Score < team1Score) {
                        winner = match.team2Name || 'Team B';
                        points.team2 = 2;
                    } else {
                        winner = 'Tie';
                        points.team1 = 1;
                        points.team2 = 1;
                    }
                }

                results.holeResults.push({
                    hole: hole,
                    team1Score: team1Score,
                    team2Score: team2Score,
                    winner: winner,
                    points: points
                });

                results.team1Points += points.team1;
                results.team2Points += points.team2;

                // Track 9-hole segments
                if (hole <= 9) {
                    results.front9Team1 += points.team1;
                    results.front9Team2 += points.team2;
                } else {
                    results.back9Team1 += points.team1;
                    results.back9Team2 += points.team2;
                }
            }

            // Add 9-hole bonuses
            if (courseData.holes >= 9) {
                if (results.front9Team1 > results.front9Team2) {
                    results.team1Points += 2;
                } else if (results.front9Team2 > results.front9Team1) {
                    results.team2Points += 2;
                } else if (results.front9Team1 === results.front9Team2 && results.front9Team1 > 0) {
                    results.team1Points += 1;
                    results.team2Points += 1;
                }

                if (courseData.holes === 18) {
                    if (results.back9Team1 > results.back9Team2) {
                        results.team1Points += 2;
                    } else if (results.back9Team2 > results.back9Team1) {
                        results.team2Points += 2;
                    } else if (results.back9Team1 === results.back9Team2 && results.back9Team1 > 0) {
                        results.team1Points += 1;
                        results.team2Points += 1;
                    }
                }
            }

            return results;
        }

        function calculateTeamScoreForHole(match, teamName, hole) {
            const team = match[teamName];
            let teamScore = null;

            if (courseData.matchFormat === '2v2-total') {
                // Add both players' net scores
                let total = 0;
                let hasScores = 0;
                
                team.forEach((player, index) => {
                    const scoreKey = `match${match.id}-${teamName}-${index}-hole${hole}`;
                    const grossScore = scores[scoreKey];
                    
                    if (grossScore && !isNaN(grossScore)) {
                        const holeHandicap = courseData.handicaps[hole - 1];
                        const strokes = calculateStrokesForHole(player.handicap, holeHandicap);
                        const netScore = parseInt(grossScore) - strokes;
                        total += netScore;
                        hasScores++;
                    }
                });
                
                if (hasScores === team.length) {
                    teamScore = total;
                }
                
            } else if (courseData.matchFormat === '2v2-low') {
                // Take best net score
                let bestScore = null;
                
                team.forEach((player, index) => {
                    const scoreKey = `match${match.id}-${teamName}-${index}-hole${hole}`;
                    const grossScore = scores[scoreKey];
                    
                    if (grossScore && !isNaN(grossScore)) {
                        const holeHandicap = courseData.handicaps[hole - 1];
                        const strokes = calculateStrokesForHole(player.handicap, holeHandicap);
                        const netScore = parseInt(grossScore) - strokes;
                        
                        if (bestScore === null || netScore < bestScore) {
                            bestScore = netScore;
                        }
                    }
                });
                
                teamScore = bestScore;
                
            } else if (courseData.matchFormat === '1v1') {
                // Individual net score
                const player = team[0];
                const scoreKey = `match${match.id}-${teamName}-0-hole${hole}`;
                const grossScore = scores[scoreKey];
                
                if (grossScore && !isNaN(grossScore)) {
                    const holeHandicap = courseData.handicaps[hole - 1];
                    const strokes = calculateStrokesForHole(player.handicap, holeHandicap);
                    teamScore = parseInt(grossScore) - strokes;
                }
            }

            return teamScore;
        }

        function generateMatchPlayTable(match, results) {
            let html = '';
            
            results.holeResults.forEach((result, index) => {
                const hole = result.hole;
                const par = courseData.par[hole - 1];
                
                let rowClass = '';
                if (result.winner === (match.team1Name || 'Team A')) {
                    rowClass = 'hole-winner';
                } else if (result.winner === (match.team2Name || 'Team B')) {
                    rowClass = 'hole-winner';
                } else if (result.winner === 'Tie') {
                    rowClass = 'hole-tie';
                }
                
                html += `
                    <tr class="${rowClass}">
                        <td><strong>${hole}</strong></td>
                        <td>${par}</td>
                        <td>${result.team1Score !== null ? result.team1Score : '-'}</td>
                        <td>${result.team2Score !== null ? result.team2Score : '-'}</td>
                        <td><strong>${result.winner}</strong></td>
                        <td>${result.points.team1}-${result.points.team2}</td>
                    </tr>
                `;

                // Add 9-hole bonus rows
                if (hole === 9 && courseData.holes >= 9) {
                    const front9Winner = results.front9Team1 > results.front9Team2 ? 
                        (match.team1Name || 'Team A') : 
                        results.front9Team2 > results.front9Team1 ? 
                        (match.team2Name || 'Team B') : 'Tie';
                    
                    html += `
                        <tr class="nine-hole-bonus">
                            <td colspan="4"><strong>Front 9 Bonus</strong></td>
                            <td><strong>${front9Winner}</strong></td>
                            <td><strong>+2 pts</strong></td>
                        </tr>
                    `;
                }

                if (hole === 18 && courseData.holes === 18) {
                    const back9Winner = results.back9Team1 > results.back9Team2 ? 
                        (match.team1Name || 'Team A') : 
                        results.back9Team2 > results.back9Team1 ? 
                        (match.team2Name || 'Team B') : 'Tie';
                    
                    html += `
                        <tr class="nine-hole-bonus">
                            <td colspan="4"><strong>Back 9 Bonus</strong></td>
                            <td><strong>${back9Winner}</strong></td>
                            <td><strong>+2 pts</strong></td>
                        </tr>
                    `;
                }
            });

            return html;
        }

        function generateMatchSummary(match, results) {
            const team1Name = match.team1Name || 'Team A';
            const team2Name = match.team2Name || 'Team B';
            const matchWinner = results.team1Points > results.team2Points ? team1Name :
                               results.team2Points > results.team1Points ? team2Name : 'Tie';

            return `
                <div class="match-summary">
                    <h4>Match Summary</h4>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <div class="summary-value">${results.team1Points}</div>
                            <div class="summary-label">${team1Name} Points</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value">${results.team2Points}</div>
                            <div class="summary-label">${team2Name} Points</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value">${results.front9Team1}-${results.front9Team2}</div>
                            <div class="summary-label">Front 9</div>
                        </div>
                        ${courseData.holes === 18 ? `
                        <div class="summary-card">
                            <div class="summary-value">${results.back9Team1}-${results.back9Team2}</div>
                            <div class="summary-label">Back 9</div>
                        </div>